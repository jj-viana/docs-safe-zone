{"config":{"lang":["pt"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Vis\u00e3o Geral do Produto: Amaterasu - Safe Zone","text":"<p>O Amaterasu - Safe Zone \u00e9 uma aplica\u00e7\u00e3o web em formato de dashboard projetada para analisar e processar dados sobre criminalidade e inseguran\u00e7a no Distrito Federal e entorno. O objetivo \u00e9 informar os cidad\u00e3os, facilitar a den\u00fancia de ocorr\u00eancias de forma menos burocr\u00e1tica e auxiliar na tomada de decis\u00f5es mais direcionadas por parte dos \u00f3rg\u00e3os competentes.</p>"},{"location":"#problema-a-ser-solucionado","title":"Problema a ser Solucionado","text":"<p>Com a velocidade da internet, a dissemina\u00e7\u00e3o de not\u00edcias sobre perigos e crimes tornou-se extremamente r\u00e1pida. O produto visa utilizar essa agilidade para criar uma comunica\u00e7\u00e3o democr\u00e1tica sobre os perigos, permitindo que a popula\u00e7\u00e3o seja alertada sobre a incid\u00eancia de problemas em regi\u00f5es espec\u00edficas. A plataforma busca quebrar a burocracia, permitindo o registro de relatos informais que muitas vezes n\u00e3o se enquadram em um boletim de ocorr\u00eancia tradicional, como locais mal iluminados, movimenta\u00e7\u00f5es suspeitas ou situa\u00e7\u00f5es de ass\u00e9dio.</p>"},{"location":"#objetivos-e-diferenciais","title":"Objetivos e Diferenciais","text":"<p>O principal objetivo do projeto \u00e9 coletar e processar den\u00fancias relacionadas \u00e0 seguran\u00e7a no DF, garantindo sempre a privacidade e o anonimato dos usu\u00e1rios. Ap\u00f3s o registro de uma den\u00fancia, a plataforma informar\u00e1 ao usu\u00e1rio sobre como ele pode agir diante daquela situa\u00e7\u00e3o.</p> <p>Como objetivos secund\u00e1rios, o projeto visa: * Permitir que \u00f3rg\u00e3os competentes (como CEB, corpo de bombeiros e pol\u00edcia civil) utilizem os dados visuais dos dashboards para criar estrat\u00e9gias mais eficazes e direcionadas. * Alertar a popula\u00e7\u00e3o sobre \u00e1reas de risco ou perigos recentes, melhorando o acesso \u00e0 informa\u00e7\u00e3o.</p>"},{"location":"#perfis-de-usuario","title":"Perfis de Usu\u00e1rio","text":"<p>O sistema contar\u00e1 com dois perfis de acesso principais: * Administrador: Ter\u00e1 acesso para controlar os dashboards e gerenciar os dados do banco, podendo remover informa\u00e7\u00f5es se necess\u00e1rio. * Usu\u00e1rio: Poder\u00e1 visualizar os dados, criar novos relatos no mapa interativo e consultar o dashboard de informa\u00e7\u00f5es.</p>"},{"location":"#diagrama-do-produto","title":"Diagrama do Produto","text":"<p>O diagrama abaixo representa, em alto n\u00edvel, os atores, o Web Dashboard exposto pelo Next.js, e os principais componentes na Azure: Azure Static Web Apps (Next.js com SSR/SSG/ISR), APIs .NET no App Service (Controllers/Services/Middleware), Cosmos DB e Application Insights.</p> <pre><code>flowchart LR\n    %% Atores\n    subgraph Users\n        U[\"Usu\u00e1rio (Cidad\u00e3o)\"]\n        Admin[\"Administrador\"]\n        Agencies[\"\u00d3rg\u00e3os competentes\"]\n    end\n\n    %% Azure e Camadas\n    subgraph Azure\n        subgraph SWA[\"Azure Static Web Apps (web)\"]\n            Next[\"Next.js (SSR/SSG/ISR)\"]\n            Dashboard[\"Web Dashboard (React/Tailwind)\"]\n        end\n\n        subgraph ApiApp[\"App Service (api-core)\"]\n            API[\".NET API\n             Controllers | Services | Middleware\"]\n        end\n\n        Cosmos[(\"Azure Cosmos DB\n        (No SQL)\")]\n        AppInsights[(\"Application Insights\")]\n    end\n\n    %% Fluxos principais\n    U --&gt;|HTTPS| Dashboard\n    Admin --&gt;|HTTPS| Dashboard\n    Agencies --&gt;|HTTPS| Dashboard\n    Next --&gt;|exp\u00f5e| Dashboard\n    Dashboard --&gt;|Intera\u00e7\u00e3o| Next\n    Next --&gt;|chamadas de API| API\n\n    %% Regras de neg\u00f3cio e dados\n    API --&gt;|Dados| Cosmos\n    API --&gt;|Telemetria/Monitoramento| AppInsights\n\n    %% Estilos\n    classDef svc fill:#e8f3ff,stroke:#2b6cb0,stroke-width:1px;\n    classDef data fill:#fff7e6,stroke:#b7791f,stroke-width:1px;\n    classDef sec fill:#f0fff4,stroke:#2f855a,stroke-width:1px;\n    classDef user fill:#f7fafc,stroke:#4a5568,stroke-width:1px;\n\n    class Next,API,Dashboard svc;\n    class Cosmos data;\n    class AppInsights sec;\n    class U,Admin,Agencies user;</code></pre> <p>Legenda r\u00e1pida: - Frontend: Next.js hospedado em Azure Static Web Apps, renderiza React/Tailwind e realiza chamadas server-side para a API .NET (evitando CORS). Client-side fetch \u00e9 opcional e requer CORS. - .NET API (App Service): controllers finos; regras de neg\u00f3cio em services; middleware de erros padronizados. - Cosmos DB: persist\u00eancia (Core SQL), propriedades camelCase. - Segredos: apenas vari\u00e1veis de ambiente (App Settings / SWA Configuration). - Application Insights: telemetria entre servi\u00e7os.</p>"},{"location":"#tecnologias-utilizadas","title":"Tecnologias Utilizadas","text":"<p>A equipe de desenvolvimento utilizar\u00e1 as seguintes tecnologias para a constru\u00e7\u00e3o do produto: * Frontend (Web): Next.js (App Router, SSR/SSG/ISR), React e Tailwind CSS. * APIs: C#/.NET 9 (Controllers finos; regras em Services; Middleware central de erros/logs). * Hospedagem: Azure Static Web Apps (Next.js) e Azure App Service (APIs .NET). * Banco de Dados: Azure Cosmos DB (Core SQL), com propriedades em camelCase. * Seguran\u00e7a e Segredos: vari\u00e1veis de ambiente (App Settings, SWA Configuration). * Observabilidade: Azure Application Insights. * Metodologia: Scrum, com sprints semanais. * Ferramentas: Azure, GitHub Actions, Discord, Google Docs, GitHub, Git, VSCode, entre outras.</p>"},{"location":"#como-comecar-dev","title":"Como come\u00e7ar (dev)","text":"<p>Esta se\u00e7\u00e3o descreve rapidamente como configurar e iniciar o reposit\u00f3rio localmente para desenvolvimento, seguindo as conven\u00e7\u00f5es do projeto.</p>"},{"location":"#estrutura-do-repositorio","title":"Estrutura do reposit\u00f3rio","text":"<pre><code>.\n\u251c\u2500 web/   # Next.js (App Router) + Tailwind\n\u2514\u2500 api/   # ASP.NET Core 9 (Cosmos DB / App Insights)\n</code></pre>"},{"location":"#pre-requisitos","title":"Pr\u00e9-requisitos","text":"<ul> <li>Node.js 18+ (recomendado 20+)</li> <li>PNPM/NPM/Yarn (ex.: npm)</li> <li>.NET SDK 9.0+</li> <li>Conta Azure</li> </ul>"},{"location":"#configuracao-desenvolvimento","title":"Configura\u00e7\u00e3o (desenvolvimento)","text":"<p>1) API (.NET)</p> <ul> <li>No desenvolvimento local, configure via arquivo: edite <code>api/appsettings.Development.json</code> (n\u00e3o versionado por padr\u00e3o pelo <code>.gitignore</code>). Preencha os campos m\u00ednimos:</li> </ul> <pre><code>{\n    \"CosmosDB\": {\n        \"ConnectionString\": \"&lt;sua-cosmos-connection-string&gt;\",\n        \"DatabaseId\": \"ReportsDb\",\n        \"ContainerId\": \"Reports\"\n    },\n    \"ApplicationInsights\": {\n        \"ConnectionString\": \"&lt;opcional&gt;\"\n    },\n    \"Cors\": {\n        \"AllowedOrigins\": [\n            \"https://localhost:3000\"\n        ]\n    }\n}\n</code></pre> <ul> <li> <p>Porta/local por padr\u00e3o (launchSettings):         - HTTP: http://localhost:5206         - HTTPS: https://localhost:7040</p> </li> <li> <p>CORS: ajuste <code>Cors:AllowedOrigins</code> no <code>appsettings.Development.json</code> para incluir o front (<code>https://localhost:3000</code>).</p> </li> </ul> <p>2) Web (Next.js)</p> <ul> <li>A base de URL da API \u00e9 lida de <code>NEXT_PUBLIC_API_BASE_URL</code>. O cliente j\u00e1 usa por padr\u00e3o <code>http://localhost:5206</code>.</li> <li>Se precisar customizar, crie <code>web/.env.local</code>:</li> </ul> <pre><code>cd web\nnpm install\nprintf \"NEXT_PUBLIC_API_BASE_URL=http://localhost:5206\\n\" &gt; .env.local\n</code></pre>"},{"location":"#subindo-os-servicos","title":"Subindo os servi\u00e7os","text":"<p>Em dois terminais:</p> <p>1) API <pre><code>cd api\ndotnet restore\ndotnet build\ndotnet run\n</code></pre></p> <p>2) Web <pre><code>cd web\nnpm install\nnpm run build\nnpm run lint\nnpm run dev\n</code></pre></p>"},{"location":"#verificacao-rapida","title":"Verifica\u00e7\u00e3o r\u00e1pida","text":"<ul> <li>Front-end: http://localhost:3000</li> <li>Swagger (API):<ul> <li>https://localhost:7040/swagger</li> <li>ou http://localhost:5206/swagger</li> </ul> </li> </ul>"},{"location":"#documentacao-e-convencoes","title":"Documenta\u00e7\u00e3o e conven\u00e7\u00f5es","text":"<ul> <li>Documenta\u00e7\u00e3o geral: veja a pasta <code>docs/</code> (ex.: <code>docs/README.md</code>)</li> <li>Conven\u00e7\u00f5es do projeto (estrutura, branches, padr\u00f5es): <code>docs/conventions.md</code></li> <li>Guia r\u00e1pido e integra\u00e7\u00f5es: <code>docs/QUICK_START.md</code>, <code>docs/api.md</code>, <code>docs/api-integration.md</code></li> </ul>"},{"location":"arquitetura/","title":"Arquitetura do Projeto Safe Zone","text":""},{"location":"arquitetura/#1-arquitetura-visao-geral","title":"1. Arquitetura (Vis\u00e3o Geral)","text":"<p>O projeto segue uma arquitetura moderna de Single Page Application (SPA) com um backend desacoplado (API RESTful) e banco de dados NoSQL em nuvem.</p> <p>Em termos de padr\u00e3o arquitetural, o backend \u00e9 classificado como uma Arquitetura Monol\u00edtica em Camadas. Embora utilize o framework MVC do ASP.NET Core, a estrutura \u00e9 definida pela separa\u00e7\u00e3o l\u00f3gica de responsabilidades (Apresenta\u00e7\u00e3o, Servi\u00e7o, Dados) dentro de uma \u00fanica unidade de implanta\u00e7\u00e3o (Monolito), o que facilita o desenvolvimento inicial e a manuten\u00e7\u00e3o.</p> <p>Esquema de Alto N\u00edvel:</p> <pre><code>graph LR\n    User[Usu\u00e1rio] --&gt;|HTTPS| Frontend[\"Frontend (Next.js)\"]\n    Frontend --&gt;|REST / JSON| API[\"Backend API (.NET 9)\"]\n    API --&gt;|SDK| DB[(Azure Cosmos DB)]\n    API --&gt;|Telemetry| AppInsights[Application Insights]</code></pre> <ul> <li>Frontend: Aplica\u00e7\u00e3o web constru\u00edda com Next.js (React), utilizando TypeScript e Tailwind CSS. Possui integra\u00e7\u00e3o com mapas (<code>leaflet</code>) e usa a autentica\u00e7\u00e3o nativa do Azure Static Web Apps (Azure AD/Entra ID) para proteger a \u00e1rea administrativa.</li> <li>Backend: Web API desenvolvida em .NET 9 (C#). Respons\u00e1vel pela l\u00f3gica de neg\u00f3cios, valida\u00e7\u00e3o e persist\u00eancia de dados.</li> <li>Banco de Dados: Azure Cosmos DB (NoSQL), utilizado para armazenar os relat\u00f3rios de crimes de forma escal\u00e1vel e flex\u00edvel.</li> <li>Observabilidade: Integra\u00e7\u00e3o com Azure Application Insights para monitoramento de logs e telemetria (incluindo consumo de RUs do Cosmos DB).</li> </ul>"},{"location":"arquitetura/#2-visao-logica","title":"2. Vis\u00e3o L\u00f3gica","text":"<p>A aplica\u00e7\u00e3o backend est\u00e1 estruturada em camadas l\u00f3gicas para separa\u00e7\u00e3o de responsabilidades:</p> <ul> <li>Camada de Apresenta\u00e7\u00e3o (Controllers):<ul> <li>Exp\u00f5e endpoints REST (ex: <code>ReportsController</code>).</li> <li>Recebe requisi\u00e7\u00f5es HTTP e DTOs (<code>CreateReportRequest</code>, <code>UpdateReportRequest</code>).</li> <li>Retorna respostas padronizadas (<code>ReportResponse</code>).</li> </ul> </li> <li>Camada de Servi\u00e7o (Services):<ul> <li>Cont\u00e9m a regra de neg\u00f3cios principal (<code>ReportService</code>).</li> <li>Realiza normaliza\u00e7\u00e3o de dados (ex: datas para UTC, trim de strings).</li> <li>Gerencia a l\u00f3gica de telemetria customizada (<code>CosmosTelemetry</code>).</li> </ul> </li> <li>Camada de Dados (Data Access):<ul> <li>N\u00e3o utiliza um ORM tradicional (como Entity Framework), mas sim o SDK nativo do Azure Cosmos DB para m\u00e1xima performance.</li> <li>O acesso \u00e9 feito diretamente via <code>Container</code> injetado no servi\u00e7o.</li> </ul> </li> <li>Configura\u00e7\u00e3o:<ul> <li>Utiliza o padr\u00e3o <code>IOptions</code> para injetar configura\u00e7\u00f5es (<code>CosmosOptions</code>) a partir do <code>appsettings.json</code>.</li> </ul> </li> </ul>"},{"location":"arquitetura/#3-visao-de-dados-der-mer-modelo-de-documento","title":"3. Vis\u00e3o de Dados (DER-MER / Modelo de Documento)","text":"<p>Como o banco de dados \u00e9 o Azure Cosmos DB (NoSQL), n\u00e3o existe um DER (Diagrama Entidade-Relacionamento) relacional tradicional com tabelas e chaves estrangeiras. Em vez disso, temos um Modelo de Documento onde os dados s\u00e3o armazenados como JSON.</p> <p>A entidade principal \u00e9 o Report, que \u00e9 armazenado em um container (chamado <code>Reports</code>).</p> <p>Modelo de Entidade (Documento JSON):</p> <pre><code>erDiagram\n    REPORT {\n        string id PK \"GUID (Partition Key)\"\n        string crimeGenre \"G\u00eanero do crime\"\n        string crimeType \"Tipo do crime\"\n        string description \"Descri\u00e7\u00e3o do incidente\"\n        string location \"Endere\u00e7o/Local\"\n        string region \"Regi\u00e3o\"\n        datetime crimeDate \"Data do crime (UTC)\"\n        string status \"Status (ex: Draft)\"\n        datetime createdDate \"Data de cria\u00e7\u00e3o\"\n        boolean resolved \"Se foi resolvido\"\n    }\n    REPORTER_DETAILS {\n        string ageGroup \"Faixa et\u00e1ria\"\n        string ethnicity \"Etnia\"\n        string genderIdentity \"Identidade de g\u00eanero\"\n        string sexualOrientation \"Orienta\u00e7\u00e3o sexual\"\n    }\n\n    REPORT ||--o| REPORTER_DETAILS : \"cont\u00e9m (embedded)\"</code></pre> <p>Detalhes do Modelo: *   Particionamento: A chave de parti\u00e7\u00e3o (<code>PartitionKey</code>) \u00e9 o pr\u00f3prio <code>/id</code>, para uma estrat\u00e9gia otimizada para leituras por ID (Point Reads), mas que pode exigir cross-partition queries para buscas por outros campos se o volume de dados for muito grande. *   ReporterDetails: \u00c9 um objeto aninhado (embedded) dentro do documento do relat\u00f3rio, n\u00e3o uma tabela separada. Isso \u00e9 t\u00edpico de modelagem NoSQL para evitar joins.</p>"},{"location":"ci-cd/","title":"CI/CD","text":""},{"location":"ci-cd/#cicd-workflows-do-github-actions-web-api","title":"CI/CD \u2014 Workflows do GitHub Actions (Web + API)","text":"<p>Este documento descreve como funciona o nosso CI/CD, o que cada workflow faz, os pr\u00e9-requisitos (Azure, segredos e permiss\u00f5es), e o passo a passo de configura\u00e7\u00e3o.</p>"},{"location":"ci-cd/#visao-geral","title":"Vis\u00e3o geral","text":"<ul> <li>Integra\u00e7\u00e3o Cont\u00ednua (CI): valida PRs com build e qualidade do front-end (Next.js) e build + testes da API (.NET).</li> <li>Entrega Cont\u00ednua (CD): a cada push em <code>main</code>, constr\u00f3i artefatos, faz login no Azure via OIDC, publica o front-end no Azure Static Web Apps (SWA), publica a API no Azure App Service e cria uma release com tag SemVer autom\u00e1tica (patch incrementado).</li> </ul> <p>Workflows:</p> <ul> <li><code>.github/workflows/pr-validation.yml</code> \u2014 PR Validation (CI)</li> <li><code>.github/workflows/release-deploy.yml</code> \u2014 Release Deploy (CD)</li> </ul> <p>Branches (conforme conven\u00e7\u00f5es):</p> <ul> <li><code>development</code>: base para PRs de feature/fix/chore.</li> <li><code>main</code>: produ\u00e7\u00e3o (imut\u00e1vel, protegida). Merge de <code>development</code> \u2192 <code>main</code> dispara deploy.</li> </ul>"},{"location":"ci-cd/#pr-validation-ci","title":"PR Validation (CI)","text":"<p>Arquivo: <code>.github/workflows/pr-validation.yml</code></p> <p>Disparo:</p> <ul> <li>Em PRs cujo destino \u00e9 <code>development</code>.</li> <li>Em PRs cujo destino \u00e9 <code>main</code> e origem \u00e9 <code>development</code> (garante que apenas merge de <code>development</code> para <code>main</code> seja validado aqui).</li> </ul> <p>Jobs e etapas:</p> <p>1) Job <code>web</code> \u2014 Web Quality Checks</p> <ul> <li>Runner: <code>ubuntu-latest</code></li> <li>Working dir: <code>web/</code></li> <li>Node.js: 20 (<code>actions/setup-node@v4</code> com cache de npm)</li> <li>Passos:<ul> <li>Checkout</li> <li><code>npm ci</code> (instala depend\u00eancias)</li> <li><code>npm run lint</code></li> <li><code>npm run build</code></li> </ul> </li> </ul> <p>2) Job <code>api</code> \u2014 API Build and Tests</p> <ul> <li>Runner: <code>ubuntu-latest</code></li> <li>.NET: 9.0 (<code>actions/setup-dotnet@v4</code>)</li> <li>Vari\u00e1veis de ambiente para otimiza\u00e7\u00e3o do CLI .NET</li> <li>Passos:<ul> <li>Checkout</li> <li><code>dotnet restore api/api.sln</code></li> <li><code>dotnet build api/api.sln --configuration Release --no-restore</code></li> <li>Verifica segredos do Cosmos DB (<code>TEST_COSMOS_CONNECTION_STRING</code>, etc.)</li> <li><code>dotnet test api/api.sln --configuration Release --no-build --verbosity normal</code></li> </ul> </li> </ul> <p>Resultado esperado:</p> <ul> <li>PRs s\u00f3 podem ser mergeados ap\u00f3s lint + build do <code>web/</code> e build + testes do <code>api/</code> passarem. Isso reduz regress\u00f5es e mant\u00e9m a qualidade antes de chegar na branch <code>main</code>.</li> </ul>"},{"location":"ci-cd/#release-deploy-cd","title":"Release Deploy (CD)","text":"<p>Arquivo: <code>.github/workflows/release-deploy.yml</code></p> <p>Disparo:</p> <ul> <li><code>push</code> na branch <code>main</code> (merge de release) com filtros de path (<code>web/**</code>, <code>api/**</code>, <code>tests/**</code>, workflow file) e manual via <code>workflow_dispatch</code>.</li> </ul> <p>Permiss\u00f5es do job:</p> <ul> <li><code>id-token: write</code> (requerido para OIDC com Azure)</li> <li><code>contents: write</code> (para criar release e tag)</li> </ul> <p>O que o pipeline faz:</p> <p>1) Detec\u00e7\u00e3o de mudan\u00e7as</p> <ul> <li>Verifica se houve altera\u00e7\u00f5es em <code>web/</code> ou <code>api/</code> (incluindo <code>tests/</code>) para executar apenas os jobs necess\u00e1rios.</li> </ul> <p>2) Build do front-end (se houver mudan\u00e7as em <code>web/</code>)</p> <ul> <li>Node.js 20</li> <li><code>npm ci</code> em <code>web/</code></li> <li>Injeta vari\u00e1veis de ambiente de build:<ul> <li><code>NEXT_PUBLIC_API_BASE_URL</code></li> <li><code>NEXT_PUBLIC_AZURE_TENANT_ID</code></li> <li><code>NEXT_PUBLIC_AZURE_CLIENT_ID</code></li> <li><code>NEXT_PUBLIC_AZURE_REDIRECT_URI</code></li> <li><code>NEXT_PUBLIC_AZURE_API_SCOPES</code></li> <li><code>NEXT_PUBLIC_RECAPTCHA_SITE_KEY</code></li> </ul> </li> <li><code>npm run build</code> (gera <code>.next</code>)</li> </ul> <p>3) Build/Publish da API (se houver mudan\u00e7as em <code>api/</code>)</p> <ul> <li>.NET 9.0</li> <li>Verifica presen\u00e7a dos segredos de teste do Cosmos DB</li> <li><code>dotnet restore api/api.sln</code></li> <li><code>dotnet publish api/api.csproj -c Release -o publish/api</code></li> </ul> <p>4) Login no Azure com OIDC</p> <ul> <li><code>azure/login@v2</code> usando <code>AZURE_CLIENT_ID</code>, <code>AZURE_TENANT_ID</code>, <code>AZURE_SUBSCRIPTION_ID</code></li> </ul> <p>5) Deploy do front-end (SWA) (se <code>web</code> mudou)</p> <ul> <li><code>Azure/static-web-apps-deploy@v1</code></li> <li>Publica artefatos de <code>web/.next</code> para o Azure Static Web Apps</li> <li>Usa token de implanta\u00e7\u00e3o do SWA (<code>AZURE_STATIC_WEB_APPS_API_TOKEN</code>)</li> </ul> <p>6) Deploy da API (App Service) (se <code>api</code> mudou)</p> <ul> <li><code>azure/webapps-deploy@v3</code></li> <li>Publica pasta <code>publish/api</code> no App Service (<code>app-name</code> e <code>resource-group-name</code> do segredo)</li> </ul> <p>7) Health checks (opcional)</p> <ul> <li>Se configurados, valida URLs de sa\u00fade do front-end e da API (5 tentativas com backoff)</li> </ul> <p>8) Release e tag SemVer autom\u00e1tica</p> <ul> <li>Determina a pr\u00f3xima tag (<code>vX.Y.Z</code>) incrementando <code>PATCH</code> da \u00faltima tag existente (ou inicia em <code>v0.1.0</code>)</li> <li>Cria release no GitHub com <code>softprops/action-gh-release@v1</code></li> </ul>"},{"location":"ci-cd/#pre-requisitos","title":"Pr\u00e9-requisitos","text":""},{"location":"ci-cd/#recursos-no-azure","title":"Recursos no Azure","text":"<ul> <li>Azure Static Web Apps (SWA) para hospedar o front-end SSR do Next.js.</li> <li>Azure App Service (Linux) para hospedar a API .NET.</li> <li>Resource Group contendo os recursos acima.</li> </ul>"},{"location":"ci-cd/#identidade-e-acesso-oidc","title":"Identidade e Acesso (OIDC)","text":"<ul> <li>Um App Registration (Microsoft Entra) com Service Principal para OIDC.</li> <li>Federated Credentials configuradas para o reposit\u00f3rio/branch (<code>main</code>) usado no deploy.</li> <li>RBAC m\u00ednimo:<ul> <li>Para App Service: <code>Website Contributor</code> no recurso da WebApp OU <code>Contributor</code> no Resource Group.</li> <li>Para cen\u00e1rios simples, <code>Contributor</code> no RG garante permiss\u00f5es de deploy.</li> </ul> </li> </ul>"},{"location":"ci-cd/#segredos-no-github-repository-secrets","title":"Segredos no GitHub (Repository Secrets)","text":"<p>Obrigat\u00f3rios para deploy e build:</p> <ul> <li><code>AZURE_CLIENT_ID</code> \u2014 Client ID do App Registration (OIDC)</li> <li><code>AZURE_TENANT_ID</code> \u2014 Tenant ID (OIDC)</li> <li><code>AZURE_SUBSCRIPTION_ID</code> \u2014 Subscription ID (OIDC)</li> <li><code>AZURE_RESOURCE_GROUP</code> \u2014 Nome do Resource Group onde est\u00e1 a WebApp</li> <li><code>AZURE_WEBAPP_NAME</code> \u2014 Nome do App Service (API)</li> <li><code>AZURE_STATIC_WEB_APPS_API_TOKEN</code> \u2014 Token de implanta\u00e7\u00e3o do SWA</li> <li><code>NEXT_PUBLIC_API_BASE_URL</code> \u2014 Base URL da API usada pelo Next (ex.: <code>https://&lt;app&gt;.azurewebsites.net</code>)</li> <li><code>NEXT_PUBLIC_AZURE_TENANT_ID</code> \u2014 Tenant ID para autentica\u00e7\u00e3o no front-end</li> <li><code>NEXT_PUBLIC_AZURE_CLIENT_ID</code> \u2014 Client ID para autentica\u00e7\u00e3o no front-end</li> <li><code>NEXT_PUBLIC_AZURE_REDIRECT_URI</code> \u2014 Redirect URI para autentica\u00e7\u00e3o</li> <li><code>NEXT_PUBLIC_AZURE_API_SCOPES</code> \u2014 Scopes da API</li> <li><code>NEXT_PUBLIC_RECAPTCHA_SITE_KEY</code> \u2014 Chave do ReCaptcha</li> </ul> <p>Obrigat\u00f3rios para testes (CI e CD check):</p> <ul> <li><code>TEST_COSMOS_CONNECTION_STRING</code> \u2014 Connection string do Cosmos DB para testes</li> <li><code>TEST_COSMOS_DATABASE_ID</code> \u2014 ID do banco de dados de teste</li> <li><code>TEST_COSMOS_CONTAINER_ID</code> \u2014 ID do container de teste</li> </ul> <p>Opcionais (para health check p\u00f3s-deploy):</p> <ul> <li><code>AZURE_API_HEALTHCHECK_URL</code> \u2014 URL de health da API (ex.: <code>https://&lt;webapp&gt;.azurewebsites.net</code>)</li> <li><code>AZURE_STATIC_WEB_APP_HEALTHCHECK_URL</code> \u2014 URL do site do SWA (ex.: <code>https://&lt;swa&gt;.azurestaticapps.net</code>)</li> </ul> <p>Permiss\u00f5es do reposit\u00f3rio:</p> <ul> <li>\u201cWorkflow permissions\u201d com acesso de conte\u00fado <code>read and write</code>. O workflow j\u00e1 declara <code>permissions</code> no job, mas se houver pol\u00edticas restritivas, habilite em Settings \u2192 Actions \u2192 General.</li> </ul>"},{"location":"ci-cd/#estrutura-e-scripts","title":"Estrutura e scripts","text":"<ul> <li><code>web/</code> com <code>package.json</code> contendo scripts <code>lint</code> e <code>build</code> compat\u00edveis com Node 20.</li> <li><code>api/</code> com solu\u00e7\u00e3o <code>.sln</code> e projeto <code>.csproj</code> compil\u00e1veis em .NET 9; testes rodando em <code>dotnet test</code>.</li> </ul>"},{"location":"ci-cd/#passo-a-passo-de-configuracao","title":"Passo a passo de configura\u00e7\u00e3o","text":"<p>1) Criar recursos no Azure</p> <ul> <li>Crie um Resource Group (ex.: <code>rg-unb-safe-zone</code>).</li> <li>Crie um Azure App Service (Linux) para .NET (Runtime .NET 8/9; o deploy por publish cuida do host). Anote o <code>app name</code>.</li> <li>Crie um Azure Static Web Apps para o front-end (qualquer plano aplic\u00e1vel). Anote o token de deployment.</li> </ul> <p>2) Configurar identidade OIDC (recomendado)</p> <ul> <li>Crie um App Registration (Microsoft Entra) com Service Principal.</li> <li>Conceda RBAC no Resource Group ou no recurso da WebApp.</li> <li>Adicione Federated Credentials para o reposit\u00f3rio:<ul> <li>Entity type: <code>Branch</code></li> <li>Branch: <code>main</code></li> <li>Audience: <code>api://AzureADTokenExchange</code></li> </ul> </li> </ul> <p>3) Obter o Deployment Token do SWA</p> <ul> <li>No recurso do SWA, acesse \u201cManage deployment token\u201d, copie o token e salve como segredo <code>AZURE_STATIC_WEB_APPS_API_TOKEN</code> no GitHub.</li> </ul> <p>4) Criar os segredos no GitHub</p> <ul> <li>Em Settings \u2192 Security \u2192 Secrets and variables \u2192 Actions \u2192 New repository secret, crie:<ul> <li><code>AZURE_CLIENT_ID</code>, <code>AZURE_TENANT_ID</code>, <code>AZURE_SUBSCRIPTION_ID</code></li> <li><code>AZURE_RESOURCE_GROUP</code>, <code>AZURE_WEBAPP_NAME</code></li> <li><code>AZURE_STATIC_WEB_APPS_API_TOKEN</code></li> <li><code>NEXT_PUBLIC_API_BASE_URL</code></li> <li><code>NEXT_PUBLIC_AZURE_TENANT_ID</code>, <code>NEXT_PUBLIC_AZURE_CLIENT_ID</code></li> <li><code>NEXT_PUBLIC_AZURE_REDIRECT_URI</code>, <code>NEXT_PUBLIC_AZURE_API_SCOPES</code></li> <li><code>NEXT_PUBLIC_RECAPTCHA_SITE_KEY</code></li> <li><code>TEST_COSMOS_CONNECTION_STRING</code>, <code>TEST_COSMOS_DATABASE_ID</code>, <code>TEST_COSMOS_CONTAINER_ID</code></li> <li>(opcional) <code>AZURE_API_HEALTHCHECK_URL</code>, <code>AZURE_STATIC_WEB_APP_HEALTHCHECK_URL</code></li> </ul> </li> </ul> <p>5) Verificar configura\u00e7\u00f5es do projeto</p> <ul> <li><code>web/staticwebapp.config.json</code> presente e adequado \u00e0s rotas/headers.</li> <li><code>web/next.config.mjs</code> e build <code>npm run build</code> funcionando localmente com Node 20.</li> <li>O artefato de deploy do front-end inclui <code>node_modules</code> (apenas depend\u00eancias de produ\u00e7\u00e3o) para garantir a execu\u00e7\u00e3o correta no SWA.</li> <li><code>api/</code> compila e testa localmente com .NET 9.</li> </ul> <p>6) Fluxo de uso</p> <ul> <li>Abra PRs para <code>development</code>. O workflow de valida\u00e7\u00e3o executa lint/build (web) e build/testes (.NET).</li> <li>Ap\u00f3s aprova\u00e7\u00f5es, fa\u00e7a merge de <code>development</code> \u2192 <code>main</code>. O workflow de release executa o deploy no Azure e cria uma release com tag SemVer (auto <code>PATCH</code>).</li> </ul>"},{"location":"ci-cd/#versionamento-e-tags-semver","title":"Versionamento e tags (SemVer)","text":"<ul> <li>A release cria uma tag autom\u00e1tica incrementando o <code>PATCH</code> da \u00faltima tag compat\u00edvel (<code>vX.Y.Z</code>).</li> <li>Se n\u00e3o existir tag, come\u00e7amos em <code>v0.1.0</code>.</li> <li>Para mudan\u00e7as <code>MINOR</code> ou <code>MAJOR</code>, crie manualmente a tag desejada antes do merge ou ajuste o processo (ex.: usar uma a\u00e7\u00e3o de conventional commits/semver). Conforme conven\u00e7\u00f5es, mantenha a disciplina de tags no <code>main</code>.</li> </ul>"},{"location":"ci-cd/#troubleshooting","title":"Troubleshooting","text":"<p>Login no Azure (OIDC) falha</p> <ul> <li>Confirme <code>AZURE_CLIENT_ID</code>, <code>AZURE_TENANT_ID</code>, <code>AZURE_SUBSCRIPTION_ID</code>.</li> <li>Verifique se h\u00e1 Federated Credential para o reposit\u00f3rio/branch <code>main</code>.</li> <li>Garanta RBAC suficiente (m\u00ednimo <code>Website Contributor</code> na WebApp ou <code>Contributor</code> no RG).</li> </ul> <p>Erro no deploy do SWA</p> <ul> <li>Verifique <code>AZURE_STATIC_WEB_APPS_API_TOKEN</code> e se ele corresponde ao SWA correto.</li> <li>Confira <code>app_location</code> (<code>web</code>), <code>app_artifact_location</code> (<code>web/.next</code>) e <code>skip_app_build: true</code> (o build j\u00e1 ocorreu antes).</li> </ul> <p>Erro no deploy do App Service</p> <ul> <li>Verifique <code>AZURE_WEBAPP_NAME</code> e <code>AZURE_RESOURCE_GROUP</code>.</li> <li>Confirme permiss\u00f5es RBAC para o Service Principal.</li> <li>Veja logs de <code>azure/webapps-deploy@v3</code> e o Log Stream do App Service.</li> </ul> <p>Falhas de build/lint no <code>web/</code></p> <ul> <li>Garanta Node 20 em ambiente local e compatibilidade de deps.</li> <li>Rode <code>npm ci &amp;&amp; npm run lint &amp;&amp; npm run build</code> localmente para reproduzir.</li> </ul> <p>Testes .NET falhando</p> <ul> <li>Execute localmente <code>dotnet restore &amp;&amp; dotnet build &amp;&amp; dotnet test</code> em <code>api/</code> para isolar.</li> </ul> <p>Health check falha</p> <ul> <li>Revise URLs e endpoints. Considere expor <code>/health</code> na API e usar a URL p\u00fablica do SWA para o front-end.</li> </ul> <p>Conflito de tag na release</p> <ul> <li>Se a tag calculada j\u00e1 existir, ajuste manualmente as tags (apague a antiga ou crie uma nova vers\u00e3o coerente) e re-dispare o workflow.</li> </ul>"},{"location":"ci-cd/#resumo-do-fluxo","title":"Resumo do fluxo","text":"<ul> <li>Dev abre PR \u2192 CI valida (<code>web</code> lint/build e <code>api</code> build/test).</li> <li>Merge <code>development</code> \u2192 <code>main</code> \u2192 CD executa deploy no SWA + App Service, roda health checks e cria release com tag SemVer.</li> </ul>"},{"location":"conventions/","title":"Conven\u00e7\u00f5es de Desenvolvimento","text":"<p>Este documento define padr\u00f5es e boas pr\u00e1ticas para desenvolvimento do projeto, cobrindo frontend (Next.js/React/Tailwind), servidor web com Next.js (deploy em Azure Static Web Apps), APIs em C#/.NET (deploy em Azure App Service), banco de dados (Azure Cosmos DB), e infraestrutura (servi\u00e7os gerenciados em Azure), al\u00e9m de fluxo Git, nomenclaturas, idioma e qualidade.</p>"},{"location":"conventions/#sumario","title":"Sum\u00e1rio","text":"<ul> <li>Objetivos e Escopo</li> <li>Estrutura de Pastas do Reposit\u00f3rio</li> <li>Idioma do C\u00f3digo e Commits</li> <li>Coment\u00e1rios</li> <li>Fluxo de Git e Versionamento</li> <li>Branches</li> <li>Commits</li> <li>Versionamento (SemVer)</li> <li>Nomenclatura</li> <li>Arquivos e Pastas</li> <li>Vari\u00e1veis e Constantes (JS)</li> <li>Fun\u00e7\u00f5es</li> <li>Web: Next.js, React e Tailwind</li> <li>Next.js (App Router, SSR/SSG/ISR)</li> <li>React (componentes, hooks, estado)</li> <li>Tailwind CSS</li> <li>Web: Next.js em Azure Static Web Apps (SSR/Proxy para API .NET)</li> <li>APIs: C#/.NET</li> <li>Estrutura de Pastas</li> <li>Padr\u00f5es de C\u00f3digo</li> <li>Boas Pr\u00e1ticas de API</li> <li>Banco de Dados: Azure Cosmos DB</li> <li>Nomenclatura</li> <li>Migrations e Seeds</li> <li>Boas Pr\u00e1ticas SQL</li> <li>Infraestrutura: Azure</li> <li>Padr\u00f5es Gerais</li> <li>Qualidade: Lint, Formata\u00e7\u00e3o, Testes e Hooks</li> <li>Lint e Formata\u00e7\u00e3o</li> <li>Testes</li> <li>Hooks</li> <li>Seguran\u00e7a e Configura\u00e7\u00f5es</li> <li>Documenta\u00e7\u00e3o</li> </ul>"},{"location":"conventions/#objetivos-e-escopo","title":"Objetivos e Escopo","text":"<ul> <li>Padronizar o c\u00f3digo e o fluxo de trabalho para aumentar legibilidade, qualidade e velocidade de entrega.</li> <li>Reduzir retrabalho, conflitos e diverg\u00eancias entre equipes.</li> <li>Cobrir o ciclo de desenvolvimento: codifica\u00e7\u00e3o, revis\u00e3o, integra\u00e7\u00e3o, deploy e documenta\u00e7\u00e3o.</li> </ul>"},{"location":"conventions/#estrutura-de-pastas-do-repositorio","title":"Estrutura de Pastas do Reposit\u00f3rio","text":"<p>A estrutura padr\u00e3o do reposit\u00f3rio \u00e9 a seguinte. Use-a como refer\u00eancia para onde criar arquivos e como organizar m\u00f3dulos:</p> <pre><code>.\n\u251c\u2500 docs/                      # diagramas, decis\u00f5es (ADRs) e notas\n\u2502  \u251c\u2500 conventions.md\n\u251c\u2500 web/                       # Next.js (App Router) + Tailwind\n\u2502  \u251c\u2500 app/\n\u2502  \u251c\u2500 components/\n\u2502  \u251c\u2500 features/\n\u2502  \u251c\u2500 lib/\n\u2502  \u251c\u2500 public/\n\u2502  \u251c\u2500 styles/\n\u2502  \u251c\u2500 middleware.ts\n\u2502  \u251c\u2500 next.config.mjs\n\u2502  \u251c\u2500 package.json\n\u2502  \u251c\u2500 staticwebapp.config.json\n\u2502  \u251c\u2500 jest.config.ts\n\u2502  \u2514\u2500 playwright.config.ts\n\u251c\u2500 api/                       # .NET 9 (App Service)\n\u2502  \u251c\u2500 src/\n\u2502  \u2502  \u251c\u2500 Controllers/\n\u2502  \u2502  \u251c\u2500 Services/\n\u2502  \u2502  \u251c\u2500 Middleware/\n\u2502  \u2502  \u251c\u2500 Configuration/\n\u2502  \u2502  \u251c\u2500 Models/\n\u2502  \u2502  \u251c\u2500 Interface/\n\u2502  \u2502  \u251c\u2500 Validators/          # opcional (FluentValidation)\n\u2502  \u2502  \u251c\u2500 Program.cs\n\u2502  \u2502  \u2514\u2500 Api.csproj\n\u2502  \u2514\u2500 tests/\n\u2502     \u251c\u2500 Unit/\n\u2502     \u251c\u2500 Integration/\n\u2502     \u251c\u2500 Contract/\n\u2502     \u2514\u2500 Api.Tests.csproj\n\u251c\u2500 .github/\n\u2502  \u2514\u2500 workflows/\n\u2502     \u251c\u2500 web-swa.yml          # build/deploy SWA (Next SSR)\n\u2502     \u2514\u2500 api-appservice.yml   # build/test/deploy API com slot\n\u251c\u2500 .vscode/\n\u2502  \u251c\u2500 extensions.json\n\u2502  \u251c\u2500 settings.json\n\u2502  \u251c\u2500 launch.json             # debug API\n\u2502  \u2514\u2500 tasks.json\n\u251c\u2500 .editorconfig\n\u251c\u2500 .gitattributes\n\u251c\u2500 .gitignore\n\u251c\u2500 .husky/                    # hooks (com lint-staged/commitlint)\n\u251c\u2500 package.json               # se usar workspaces para utilit\u00e1rios JS compartilhados\n\u251c\u2500 commitlint.config.cjs\n\u251c\u2500 README.md\n\u2514\u2500 .env.example               # sem segredos (vari\u00e1veis padr\u00e3o)\n</code></pre> <p>Notas: - O front-end fica em <code>web/</code>. O back-end (.NET) fica em <code>api/</code> com <code>src/</code> e <code>tests/</code> separados. - Documenta\u00e7\u00e3o adicional (diagramas, ADRs) fica em <code>docs/architecture/</code>. - Pipelines vivem em <code>.github/workflows/</code> com nomes padronizados: <code>web-swa.yml</code> e <code>api-appservice.yml</code>. - Arquivos de configura\u00e7\u00e3o do VS Code est\u00e3o em <code>.vscode/</code>. Use-os para depura\u00e7\u00e3o da API e tarefas comuns. - Use <code>.env.example</code> como refer\u00eancia das vari\u00e1veis necess\u00e1rias; n\u00e3o comitar <code>.env</code> com segredos.</p>"},{"location":"conventions/#idioma-do-codigo-e-commits","title":"Idioma do C\u00f3digo e Commits","text":"<ul> <li>C\u00f3digo e identificadores: devem ser escritos em ingl\u00eas. Inclui nomes de arquivos e pastas, vari\u00e1veis, fun\u00e7\u00f5es, classes, enums, constantes, interfaces/tipos, chaves de objetos/JSON, rotas, nomes de migrations, al\u00e9m de nomes de branches e tags.</li> <li>Documenta\u00e7\u00e3o do projeto: deve ser escrita em portugu\u00eas (ex.: <code>README</code>, arquivos em <code>docs/</code> e guias).</li> <li>Coment\u00e1rios podem ser escritos em portugu\u00eas.</li> <li>Commits: a mensagem de commit (t\u00edtulo, corpo e rodap\u00e9) pode ser em portugu\u00eas, mantendo o padr\u00e3o de Commits para o tipo (em ingl\u00eas) e, preferencialmente, o escopo alinhado ao nome do m\u00f3dulo em ingl\u00eas.</li> <li>Ex.: <code>feat(api): adiciona rota de login</code> (tipo/scope em ingl\u00eas; resumo em portugu\u00eas).</li> <li>Corpo do commit: pode detalhar em portugu\u00eas; referencie issues quando aplic\u00e1vel.</li> </ul>"},{"location":"conventions/#comentarios","title":"Coment\u00e1rios","text":"<ul> <li>JavaScript/Node.js: use <code>//</code> (linha) ou <code>/* ... */</code> (bloco). Para fun\u00e7\u00f5es p\u00fablicas/m\u00f3dulos, prefira JSDoc <code>/** ... */</code> com descri\u00e7\u00f5es em portugu\u00eas.</li> <li>SQL (Cosmos DB consultas / scripts auxiliares): <code>--</code> (linha) e <code>/* ... */</code> (bloco) quando aplic\u00e1vel a consultas anal\u00edticas exportadas.</li> <li>YAML (pipelines ou manifests IaC): <code>#</code>.</li> <li>HTML/CSS: <code>&lt;!-- ... --&gt;</code> (HTML) e <code>/* ... */</code> (CSS).</li> <li>Diretrizes gerais:</li> <li>Explique o porqu\u00ea nos coment\u00e1rios; evite comentar o \u00f3bvio.</li> <li>Mantenha coment\u00e1rios atualizados; remova os obsoletos.</li> <li>Use <code>TODO:</code> e <code>FIXME:</code> com refer\u00eancia (ex.: <code>TODO: tratar erro X - #123</code>).</li> <li>Coment\u00e1rios de fun\u00e7\u00e3o: escreva um coment\u00e1rio geral acima do nome da fun\u00e7\u00e3o explicando claramente o que ela faz, seus par\u00e2metros, retorno e efeitos colaterais. Evite coment\u00e1rios de linha dispersos; prefira um bloco de coment\u00e1rio por fun\u00e7\u00e3o. Em JavaScript/Node.js, utilize JSDoc (<code>/** ... */</code>).</li> </ul> <p>Exemplo (coment\u00e1rio em portugu\u00eas; c\u00f3digo e identificadores em ingl\u00eas):</p> <pre><code>/**\n * Cria um novo usu\u00e1rio no sistema.\n * @param {Object} payload - Dados do usu\u00e1rio.\n * @param {string} payload.email - E-mail do usu\u00e1rio.\n * @param {string} payload.password - Senha em texto plano (ser\u00e1 hasheada).\n * @returns {Promise&lt;User&gt;} Usu\u00e1rio criado.\n * @throws {ValidationError} Quando os dados s\u00e3o inv\u00e1lidos.\n */\nasync function createUser(payload) {\n  ...\n}\n</code></pre>"},{"location":"conventions/#fluxo-de-git-e-versionamento","title":"Fluxo de Git e Versionamento","text":""},{"location":"conventions/#branches","title":"Branches","text":"<ul> <li><code>main</code>: produ\u00e7\u00e3o (imut\u00e1vel, protegida).</li> <li><code>development</code>: integra\u00e7\u00e3o cont\u00ednua de features (base para PRs de feature).</li> <li><code>feature/&lt;short-description&gt;</code>: novas funcionalidades. Ex.: <code>feature/oauth-authentication</code>.</li> <li><code>fix/&lt;short-description&gt;</code>: corre\u00e7\u00f5es de bugs. Ex.: <code>fix/db-timeout-error</code>.</li> <li><code>chore/&lt;short-description&gt;</code>: tarefas de manuten\u00e7\u00e3o (deps, configs, etc.).</li> <li><code>docs/&lt;short-description&gt;</code>: documenta\u00e7\u00e3o (sem alterar c\u00f3digo de produto).</li> </ul> <p>Regras: - Sempre criar branch a partir de <code>development</code>. - Abrir PR de <code>feature/*</code> \u2192 <code>development</code>. Releases s\u00e3o mescladas de <code>development</code> \u2192 <code>main</code>. - Branches protegidas: exigem revis\u00e3o, checks e hist\u00f3rico linear.</p>"},{"location":"conventions/#commits","title":"Commits","text":"<p>Formato: <pre><code>&lt;type&gt;[optional scope]!: &lt;short summary&gt;\n\n[body]\n</code></pre></p> <p>Tipos comuns: <code>feat</code>, <code>fix</code>, <code>docs</code>, <code>style</code>, <code>refactor</code>, <code>perf</code>, <code>test</code>, <code>build</code>, <code>ci</code>, <code>chore</code>, <code>revert</code>. Ex.: <code>feat(api): adiciona rota de login</code>.</p>"},{"location":"conventions/#versionamento-semver","title":"Versionamento (SemVer)","text":"<ul> <li>Utilizar SemVer no formato <code>MAJOR.MINOR.PATCH</code> (ex.: <code>v1.4.2</code>).</li> <li>Criar tags de release na branch <code>main</code>: <code>git tag vX.Y.Z &amp;&amp; git push --tags</code>.</li> <li>Incrementos:</li> <li><code>MAJOR</code>: mudan\u00e7as incompat\u00edveis com vers\u00f5es anteriores (breaking changes).</li> <li><code>MINOR</code>: novas funcionalidades retrocompat\u00edveis.</li> <li><code>PATCH</code>: corre\u00e7\u00f5es e pequenas melhorias sem quebra.</li> </ul>"},{"location":"conventions/#nomenclatura","title":"Nomenclatura","text":""},{"location":"conventions/#arquivos-e-pastas","title":"Arquivos e Pastas","text":"<ul> <li>Pastas: <code>kebab-case</code>. Ex.: <code>user-profile</code>, <code>data-access</code>.</li> <li>Arquivos: <code>kebab-case</code>. Ex.: <code>user-service.js</code>.</li> <li>SQL/Migrations: <code>YYYYMMDDHHMMSS_description.sql</code>. Ex.: <code>20250920150000_create_users.sql</code>.</li> </ul>"},{"location":"conventions/#variaveis-e-constantes-js","title":"Vari\u00e1veis e Constantes (JS)","text":"<ul> <li>Vari\u00e1veis e fun\u00e7\u00f5es: <code>camelCase</code>. Ex.: <code>totalPrice</code>, <code>getUserById</code>.</li> <li>Classes/Construtores: <code>PascalCase</code>. Ex.: <code>UserService</code>.</li> <li>Constantes: <code>UPPER_SNAKE_CASE</code>. Ex.: <code>MAX_RETRY_COUNT</code>.</li> <li>Seletores CSS: <code>kebab-case</code> com BEM (ver se\u00e7\u00e3o CSS).</li> </ul>"},{"location":"conventions/#funcoes","title":"Fun\u00e7\u00f5es","text":"<ul> <li>Nomear com verbo de a\u00e7\u00e3o claro: <code>createUser</code>, <code>validateToken</code>, <code>formatDate</code>.</li> <li>Fun\u00e7\u00f5es puras preferidas para utilit\u00e1rios; side effects isolados em servi\u00e7os/camadas apropriadas.</li> </ul>"},{"location":"conventions/#web-nextjs-react-e-tailwind","title":"Web: Next.js, React e Tailwind","text":"<p>Esta define os padr\u00f5es para o front-end com Next.js (App Router), React e Tailwind CSS. HTML e CSS puros podem ser usados pontualmente, mas a base deve ser componentes React com utilit\u00e1rios Tailwind.</p>"},{"location":"conventions/#nextjs-app-router-ssrssgisr","title":"Next.js (App Router, SSR/SSG/ISR)","text":"<ul> <li>App Router (<code>/app</code>). Preferir Server Components; usar Client Components quando houver intera\u00e7\u00e3o de estado ou efeitos do browser.</li> <li>Data fetching: usar <code>fetch</code> no servidor com op\u00e7\u00f5es de cache/revalidate, ou <code>Route Handlers</code> quando for preciso compor dados. Nunca replicar regra de neg\u00f3cio \u2014 sempre chamar a API .NET.</li> <li>Estrat\u00e9gias de renderiza\u00e7\u00e3o:</li> <li>SSR: p\u00e1ginas com dados sens\u00edveis ao usu\u00e1rio ou vari\u00e1veis por request.</li> <li>SSG: conte\u00fado est\u00e1tico por build.</li> <li>ISR: p\u00e1ginas est\u00e1ticas com revalida\u00e7\u00e3o (<code>revalidate: &lt;segundos&gt;</code>).</li> <li>Rotas e organiza\u00e7\u00e3o sugeridas:</li> <li><code>app/(public)/...</code> para rotas p\u00fablicas; <code>app/(private)/...</code> para \u00e1reas autenticadas.</li> <li><code>app/api/*</code> reservado para handlers utilit\u00e1rios do pr\u00f3prio Next apenas quando necess\u00e1rio (n\u00e3o substituir a API .NET).</li> <li><code>lib/</code> para helpers de fetch, schemas de valida\u00e7\u00e3o, utilit\u00e1rios puros.</li> <li><code>components/</code> para UI reutiliz\u00e1vel; <code>features/&lt;dom\u00ednio&gt;/</code> para componentes orientados a casos de uso.</li> <li>Integra\u00e7\u00e3o com API .NET: preferir proxy via rewrites do Next para <code>/api/v1/*</code> (ver se\u00e7\u00e3o de servidor/proxy), evitando CORS no browser. Alternative: usar <code>API_BASE_URL</code> apenas quando o proxy n\u00e3o for poss\u00edvel.</li> </ul>"},{"location":"conventions/#react-componentes-hooks-estado","title":"React (componentes, hooks, estado)","text":"<ul> <li>Componentes funcionais com hooks; evitar classes.</li> <li>Estado: preferir <code>useState</code>/<code>useReducer</code> local. Para dados do servidor, considerar <code>SWR</code> ou <code>TanStack Query</code> quando houver cache/reatividade; no b\u00e1sico, <code>fetch</code> em Server Components ou <code>useEffect</code> em Client Components.</li> <li>Padr\u00f5es de composi\u00e7\u00e3o: components pequenos, sem\u00e2nticos, com props tipadas. Evitar l\u00f3gica de neg\u00f3cio; apenas orquestra\u00e7\u00e3o de UI e chamadas \u00e0 API.</li> <li>Acessibilidade: utilizar atributos <code>aria-*</code>, <code>role</code> e sem\u00e2ntica HTML dentro dos componentes. Testar com React Testing Library.</li> <li>Conven\u00e7\u00f5es:</li> <li>Nomes de componentes: <code>PascalCase</code>.</li> <li>Nomes de hooks: <code>useXxx</code>.</li> <li>Evitar estado global at\u00e9 haver necessidade concreta; se necess\u00e1rio, <code>Context</code> leve por dom\u00ednio.</li> </ul>"},{"location":"conventions/#tailwind-css","title":"Tailwind CSS","text":"<ul> <li>Configura\u00e7\u00e3o: <code>tailwind.config.{js,ts}</code> com preset corporativo quando aplic\u00e1vel. Manter tokens no <code>theme.extend</code> (cores, spacing, fontSize).</li> <li>Estilo: utilit\u00e1rio-first. Evitar CSS global; preferir classes Tailwind. Quando estilos se repetirem, usar <code>@apply</code> em <code>globals.css</code> ou criar componentes estilizados.</li> <li>Nomea\u00e7\u00e3o: classes utilit\u00e1rias do Tailwind substituem BEM. Quando usar CSS modular, preferir nomes sem\u00e2nticos curtos em <code>*.module.css</code>.</li> <li>Plugins recomendados: <code>@tailwindcss/forms</code>, <code>@tailwindcss/typography</code>, <code>eslint-plugin-tailwindcss</code> para lint de classes.</li> </ul> <p>Estrutura sugerida (web): <pre><code>web/\n  app/\n    layout.tsx\n    page.tsx\n    (public)/...\n    (private)/...\n  components/\n  features/\n  lib/\n  public/\n  styles/\n    globals.css\n  middleware.ts\n  next.config.mjs\n  package.json\n</code></pre></p>"},{"location":"conventions/#web-nextjs-em-azure-static-web-apps-ssrproxy-para-api-net","title":"Web: Next.js em Azure Static Web Apps (SSR/Proxy para API .NET)","text":"<p>Next.js \u00e9 respons\u00e1vel por SSR/SSG/ISR, servir est\u00e1ticos e orquestrar chamadas \u00e0 API em C#/.NET. O deploy ser\u00e1 feito em Azure Static Web Apps (SWA) com suporte a SSR via Functions gerenciada. N\u00e3o h\u00e1 regra de neg\u00f3cio no Next \u2014 toda regra permanece nos <code>Services/</code> da API.</p>"},{"location":"conventions/#responsabilidades-do-servidor-nextjs","title":"Responsabilidades do servidor Next.js","text":"<ul> <li>Renderiza\u00e7\u00e3o SSR/SSG/ISR e entrega de assets.</li> <li>Integra\u00e7\u00e3o com backend .NET: chamadas server-side (SSR/Route Handlers) usando <code>process.env.API_BASE_URL</code> para evitar CORS; chamadas client-side usando <code>API_BASE_URL</code> com CORS habilitado na API.</li> <li>Observabilidade m\u00ednima: gerar/propagar <code>x-correlation-id</code> e logging de acesso (via middleware ou integra\u00e7\u00e3o Application Insights no App Service).</li> <li>Headers de seguran\u00e7a (CSP, no-store quando necess\u00e1rio). Em produ\u00e7\u00e3o, manter HTTPS-only.</li> </ul>"},{"location":"conventions/#configuracao-sugerida","title":"Configura\u00e7\u00e3o sugerida","text":"<ul> <li>SWA config: utilizar <code>staticwebapp.config.json</code> (de prefer\u00eancia gerado pelo SWA CLI) para rotas, fallback e headers globais (CSP, HSTS, cache). Evitar criar manualmente sem <code>swa init</code>.</li> <li>Middleware Next: <code>middleware.ts</code> pode garantir <code>x-correlation-id</code> (gera se ausente) e passar adiante para a API via header.</li> <li>Vari\u00e1veis de ambiente: definir em Azure Static Web Apps (Configuration). Privadas: <code>API_BASE_URL</code>; p\u00fablicas: <code>NEXT_PUBLIC_*</code>. Evitar <code>.env</code> commitado; fornecer <code>.env.example</code> sem segredos.</li> </ul>"},{"location":"conventions/#boas-praticas","title":"Boas Pr\u00e1ticas","text":"<ul> <li>Nunca expor chaves/segredos \u2014 usar vari\u00e1veis de ambiente (App Settings/SWA Configuration/GitHub Secrets).</li> <li>N\u00e3o criar rotas <code>app/api/*</code> para regras de neg\u00f3cio; use somente para adapta\u00e7\u00f5es pontuais da UI.</li> <li>Tratar indisponibilidade da API com mensagens amig\u00e1veis e status adequados (ex.: 503) na UI.</li> </ul>"},{"location":"conventions/#apis-cnet","title":"APIs: C#/.NET","text":"<p>As APIs de neg\u00f3cio ser\u00e3o desenvolvidas em C# utilizando .NET 9. O design segue princ\u00edpios de Clean Architecture e RESTful.</p>"},{"location":"conventions/#estrutura-de-pastas-organizacao-adotada","title":"Estrutura de Pastas (Organiza\u00e7\u00e3o Adotada)","text":"<pre><code>src/\n  Controllers/      # Endpoints HTTP (Controllers ou Minimal Handlers agrupados)\n  Services/         # Regras de neg\u00f3cio, orquestra\u00e7\u00e3o, valida\u00e7\u00f5es, integra\u00e7\u00f5es\n  Middleware/       # Componentes de pipeline (logging, error handling, correlation)\n  Configuration/    # Extens\u00f5es e registro de servi\u00e7os (ex: Cosmos, Auth, Swagger)\n  Models/           # Modelos de dom\u00ednio simplificados, DTOs (request/response), payloads externos\n  Interface/        # Interfaces de servi\u00e7os, ports, abstra\u00e7\u00f5es para infraestrutura\n</code></pre> <p>Tests: <pre><code>tests/\n  Unit/             # Testes de servi\u00e7os isolados (mocks/stubs)\n  Integration/      # Testes com servidor em mem\u00f3ria / Cosmos emulador\n  Contract/         # Valida\u00e7\u00e3o de OpenAPI / compatibilidade\n</code></pre></p> <p>Notas: - Qualquer l\u00f3gica de persist\u00eancia (ex.: chamadas ao SDK do Cosmos) residir\u00e1 em Services ou em adaptadores espec\u00edficos dentro de <code>Services/</code> (ex.: <code>Services/Data/</code>), desde que mantendo separa\u00e7\u00e3o clara de responsabilidades. - Evitar proliferar pastas; somente criar subpastas quando volume de arquivos justificar.</p>"},{"location":"conventions/#convencoes-de-codigo-c","title":"Conven\u00e7\u00f5es de C\u00f3digo C","text":"<ul> <li>Nomes de namespaces: <code>Company.Project.Context</code> (PascalCase).</li> <li>Classes, interfaces, enums: <code>PascalCase</code> (interfaces com prefixo <code>I</code>, manter consistente).</li> <li>M\u00e9todos e propriedades: <code>PascalCase</code>.</li> <li>Campos privados: <code>_camelCase</code>.</li> <li>Vari\u00e1veis locais e par\u00e2metros: <code>camelCase</code>.</li> <li>Constantes: <code>PascalCase</code>.</li> <li>Async: sufixar m\u00e9todos async com <code>Async</code> (<code>GetUserAsync</code>).</li> <li>Imutabilidade preferida em value objects.</li> </ul>"},{"location":"conventions/#organizacao-de-pastas-na-api","title":"Organiza\u00e7\u00e3o de Pastas na API","text":"<ul> <li><code>Controllers/</code>: Pontos de entrada HTTP. Apenas coordena\u00e7\u00e3o (chama service, traduz resultado). Sem regra de neg\u00f3cio.</li> <li><code>Services/</code>: L\u00f3gica de neg\u00f3cio, orquestra\u00e7\u00e3o, acesso a Cosmos (direto ou via helper), integra\u00e7\u00f5es externas.</li> <li><code>Middleware/</code>: Pipeline transversal (erro, logging, correlation-id, auth adicional se necess\u00e1rio).</li> <li><code>Configuration/</code>: Extens\u00f5es est\u00e1ticas (<code>IServiceCollection</code>, <code>WebApplicationBuilder</code>) para registro modular.</li> <li><code>Models/</code>: DTOs de entrada/sa\u00edda, modelos de integra\u00e7\u00e3o, record structs e tipos value simples.</li> <li><code>Interface/</code>: Interfaces e abstra\u00e7\u00f5es (ex.: <code>IUserService</code>, <code>ICosmosUserRepository</code>), sem DTOs.</li> <li>(Opcional) <code>Mappings/</code>: Perfis AutoMapper ou mapeamentos manuais concentrados.</li> <li>(Opcional) <code>Validators/</code>: Classes FluentValidation se volume justificar separar de Services.</li> </ul> <p>Decis\u00f5es: - Evitar controllers \u201cgordos\u201d: regra sempre em Services. - Preferir retorno uniforme (ex.: <code>Result&lt;T&gt;</code> ou ProblemDetails) convertendo no controller. - Criar subpastas em <code>Services/</code> por dom\u00ednio funcional apenas ap\u00f3s 3+ arquivos relacionados.</p>"},{"location":"conventions/#padroes-rest-e-versao","title":"Padr\u00f5es REST e Vers\u00e3o","text":"<ul> <li>Prefixo: <code>/api/v1</code>.</li> <li>Usar substantivos plurais (<code>/users</code>, <code>/orders/{id}</code>), relacionamentos em sub-recursos (<code>/users/{id}/roles</code>).</li> <li>C\u00f3digos de status: 200 OK, 201 Created (com <code>Location</code>), 204 No Content para dele\u00e7\u00e3o/updates sem body, 400 valida\u00e7\u00e3o, 404 n\u00e3o encontrado, 409 conflitos de estado, 422 regras de dom\u00ednio, 500 erros n\u00e3o tratados.</li> </ul>"},{"location":"conventions/#validacao","title":"Valida\u00e7\u00e3o","text":"<ul> <li>FluentValidation em n\u00edvel de DTO de entrada.</li> <li>Erros retornam payload padronizado: <pre><code>{\n  \"traceId\": \"&lt;id&gt;\",\n  \"errors\": [ { \"field\": \"email\", \"message\": \"Email inv\u00e1lido\" } ]\n}\n</code></pre></li> </ul>"},{"location":"conventions/#tratamento-de-erros","title":"Tratamento de Erros","text":"<ul> <li>Middleware global captura exce\u00e7\u00f5es e converte em resposta estruturada.</li> <li>Exce\u00e7\u00f5es de dom\u00ednio espec\u00edficas (ex.: <code>DomainException</code>) resultam em 422.</li> </ul>"},{"location":"conventions/#logging-e-observabilidade","title":"Logging e Observabilidade","text":"<ul> <li><code>ILogger&lt;T&gt;</code> para logging contextual.</li> <li>Correlation/Trace Id via header <code>x-correlation-id</code> (gerar se ausente).</li> <li>Telemetria: Application Insights (traces, m\u00e9tricas, depend\u00eancias, requests).</li> </ul>"},{"location":"conventions/#acesso-a-dados-cosmos-db","title":"Acesso a Dados (Cosmos DB)","text":"<ul> <li>Reposit\u00f3rios ass\u00edncronos usando SDK oficial.</li> <li>Opera\u00e7\u00f5es idempotentes quando aplic\u00e1vel.</li> <li>Otimizar parti\u00e7\u00e3o e \u00edndice (ver se\u00e7\u00e3o Cosmos DB).</li> </ul>"},{"location":"conventions/#testes","title":"Testes","text":"<ul> <li>Unit: testar <code>Services/</code> isolando depend\u00eancias (mocks de interfaces em <code>Interface/</code>). DTOs referenciados de <code>Models/</code>.</li> <li>Integration: <code>WebApplicationFactory</code> cobrindo fluxo completo e Cosmos (emulador ou conta isolada).</li> <li>Contract: snapshot/schema OpenAPI para detectar breaking changes em endpoints p\u00fablicos.</li> </ul>"},{"location":"conventions/#documentacao-e-contratos","title":"Documenta\u00e7\u00e3o e Contratos","text":"<ul> <li>OpenAPI gerado automaticamente (<code>/swagger</code> em ambiente de dev/test).</li> <li>Versionamento de contratos via m\u00faltiplos grupos se necess\u00e1rio (<code>v1</code>, <code>v2</code>).</li> </ul>"},{"location":"conventions/#boas-praticas-gerais","title":"Boas Pr\u00e1ticas Gerais","text":"<ul> <li>Fail fast em configura\u00e7\u00e3o inv\u00e1lida (lan\u00e7ar na inicializa\u00e7\u00e3o).</li> <li>Evitar l\u00f3gica em Controllers \u2014 delegar sempre a Services.</li> <li>Retornar tipos <code>Result&lt;T&gt;</code> ou ProblemDetails para consist\u00eancia.</li> </ul>"},{"location":"conventions/#banco-de-dados-azure-cosmos-db","title":"Banco de Dados: Azure Cosmos DB","text":""},{"location":"conventions/#modelo-e-organizacao","title":"Modelo e Organiza\u00e7\u00e3o","text":"<ul> <li>API alvo: <code>Core (SQL)</code>.</li> <li>Cada agregado principal do dom\u00ednio deve corresponder a um container quando justific\u00e1vel por padr\u00e3o de acesso. Evitar proliferar containers \u2014 custo e throughput fragmentam.</li> <li>Consolidar entidades com forte rela\u00e7\u00e3o de acesso em um mesmo container usando <code>type</code> (discriminador) quando leitura conjunta for frequente.</li> </ul>"},{"location":"conventions/#nomenclatura_1","title":"Nomenclatura","text":"<ul> <li>Database: <code>app-core</code> (kebab-case; usar sufixos por ambiente: <code>app-core-dev</code>, <code>app-core-stg</code>, <code>app-core-prd</code>).</li> <li>Containers: <code>kebab-case</code> singular ou plural coerente (manter consistente). Ex.: <code>users</code>, <code>orders</code>, <code>audit-logs</code>.</li> <li>Propriedades JSON: <code>camelCase</code> (alinhado ao C# via <code>JsonNamingPolicy.CamelCase</code>).</li> <li>Discriminador de tipo (quando multi-modelo no container): campo <code>type</code> com valores <code>user</code>, <code>order</code>, etc.</li> </ul>"},{"location":"conventions/#particionamento","title":"Particionamento","text":"<ul> <li>Definir <code>partitionKey</code> visando distribui\u00e7\u00e3o uniforme e padr\u00f5es de consulta conhecidos.</li> <li>Preferir chaves de alta cardinalidade e acesso balanceado: exemplos: <code>/userId</code>, <code>/tenantId</code>.</li> <li>Evitar parti\u00e7\u00e3o baseada em status ou datas que concentrem carga (<code>/status</code>).</li> <li>Para entidades raiz (ex.: usu\u00e1rios) usar o pr\u00f3prio <code>id</code> como parti\u00e7\u00e3o quando acesso primariamente for por id (<code>/id</code>).</li> </ul>"},{"location":"conventions/#indexacao","title":"Indexa\u00e7\u00e3o","text":"<ul> <li>Usar pol\u00edtica autom\u00e1tica inicialmente; otimizar removendo paths n\u00e3o usados para reduzir RU.</li> <li>Remover indexa\u00e7\u00e3o de campos grandes (ex.: descri\u00e7\u00f5es longas) se n\u00e3o houver busca por eles.</li> <li>Indexa\u00e7\u00e3o consistente para campos de filtros/pagina\u00e7\u00e3o (<code>createdAt</code>, <code>email</code>).</li> </ul>"},{"location":"conventions/#consistencia","title":"Consist\u00eancia","text":"<ul> <li>N\u00edvel padr\u00e3o: Session (equil\u00edbrio entre performance e garantia por usu\u00e1rio autenticado).</li> <li>Elevar para Strong somente quando requisito cr\u00edtico de leitura imediata ap\u00f3s escrita (custo maior). Avaliar por caso.</li> </ul>"},{"location":"conventions/#versionamento-e-evolucao-de-esquema","title":"Versionamento e Evolu\u00e7\u00e3o de Esquema","text":"<ul> <li>Itens s\u00e3o flex\u00edveis \u2014 adicionar novos campos sem migra\u00e7\u00e3o.</li> <li>Remover campos somente ap\u00f3s per\u00edodo de compatibilidade (feature flag de leitura tolerante).</li> <li>Manter testes de contrato para validar forma m\u00ednima esperada do documento.</li> </ul>"},{"location":"conventions/#acesso-e-repositorios","title":"Acesso e Reposit\u00f3rios","text":"<ul> <li>Abstrair acesso via reposit\u00f3rios ou <code>IDocumentStore</code> central.</li> <li>Opera\u00e7\u00f5es de leitura usando <code>QueryDefinition</code> parametrizada para evitar inje\u00e7\u00e3o.</li> <li>Pagina\u00e7\u00e3o com <code>ContinuationToken</code> \u2014 encapsular em servi\u00e7o utilit\u00e1rio.</li> </ul>"},{"location":"conventions/#custos-e-throughput","title":"Custos e Throughput","text":"<ul> <li>Preferir autoscale (picos imprevis\u00edveis) em ambientes produtivos.</li> <li>Monitorar RU/s consumidas e identificar queries com <code>cross-partition</code> excessivo \u2014 ajustar parti\u00e7\u00e3o ou adicionar campos de filtro.</li> <li>Agregar m\u00e9tricas no Application Insights (depend\u00eancias Cosmos).</li> </ul>"},{"location":"conventions/#seguranca","title":"Seguran\u00e7a","text":"<ul> <li>Nunca expor a Primary Key.</li> <li>Segregar permiss\u00f5es; m\u00ednimo necess\u00e1rio para ambientes de teste.</li> </ul>"},{"location":"conventions/#anti-padroes-a-evitar","title":"Anti-padr\u00f5es a Evitar","text":"<ul> <li>Container para cada entidade pequena sem necessidade de isolamento.</li> <li>Queries <code>SELECT *</code> sem proje\u00e7\u00e3o \u2014 aumenta RU.</li> <li>Parti\u00e7\u00e3o que concentra &gt;70% do tr\u00e1fego.</li> <li>Uso de Strong Consistency global sem necessidade real.</li> </ul>"},{"location":"conventions/#infraestrutura-azure","title":"Infraestrutura: Azure","text":"<p>A aplica\u00e7\u00e3o \u00e9 implantada inteiramente em servi\u00e7os gerenciados Azure. Infra como c\u00f3digo (futuro) poder\u00e1 usar Bicep ou Terraform.</p>"},{"location":"conventions/#servicos-principais","title":"Servi\u00e7os Principais","text":"<ul> <li>Azure Static Web Apps para hospedar: </li> <li>Next.js (SSR/SSG/ISR com Functions gerenciada pelo SWA)</li> <li>Azure App Service para hospedar:</li> <li>APIs .NET (separar em apps distintas conforme dom\u00ednios)</li> <li>Azure Cosmos DB (Core SQL) para persist\u00eancia.</li> <li>Azure Application Insights para telemetria e Logs para observabilidade.</li> </ul>"},{"location":"conventions/#ambientes","title":"Ambientes","text":"<ul> <li><code>dev</code>, <code>stg</code>, <code>prd</code> \u2014 isolamento por Resource Group.</li> <li>Nome de Resource Group: <code>rg-app-&lt;env&gt;</code> (ex.: <code>rg-app-dev</code>).</li> <li>Nome de Static Web App: <code>swa-web-next-&lt;env&gt;</code> (Next.js).</li> <li>Nome de App Service: <code>app-api-core-&lt;env&gt;</code> (.NET).</li> <li>Cosmos DB: <code>cosmos-app-core-&lt;env&gt;</code>.</li> </ul>"},{"location":"conventions/#naming-guidelines-geral","title":"Naming Guidelines (Geral)","text":"<ul> <li>Seguir padr\u00e3o: <code>&lt;context&gt;-&lt;role&gt;-&lt;env&gt;</code>.</li> <li>Usar somente min\u00fasculas e hifens onde o recurso permitir.</li> </ul>"},{"location":"conventions/#configuracao-e-segredos","title":"Configura\u00e7\u00e3o e Segredos","text":"<ul> <li>Vari\u00e1veis de aplica\u00e7\u00e3o definidas em App Service (Application Settings) e Azure Static Web Apps (Configuration) com prefixos por dom\u00ednio (<code>COSMOS__CONNECTION</code>, <code>AUTH__ISSUER</code>).</li> <li>Segredos sens\u00edveis mantidos como vari\u00e1veis de ambiente (App Settings no App Service e Configuration no SWA). Para CI/CD, utilizar GitHub Secrets. N\u00e3o versionar <code>.env</code>.</li> </ul>"},{"location":"conventions/#deploy-e-cicd","title":"Deploy e CI/CD","text":"<ul> <li>Pipelines (GitHub Actions):</li> <li>Web (SWA): usar <code>azure/static-web-apps-deploy</code> action ou <code>swa deploy</code>. O build deve rodar <code>next build</code> (SSR) e publicar o <code>outputLocation</code> padr\u00e3o do Next. Validar preview environments por PR.</li> <li>API (.NET): build/test/publish \u2192 Deploy para App Service (slot staging) \u2192 Swap para produ\u00e7\u00e3o quando necess\u00e1rio.</li> <li>Usar slots (<code>staging</code>) para APIs cr\u00edticas.</li> <li>Validar integridade (health endpoint <code>/health</code> ou <code>/ready</code>) p\u00f3s-deploy antes de swap.</li> </ul>"},{"location":"conventions/#observabilidade","title":"Observabilidade","text":"<ul> <li>Application Insights: </li> <li>Correlation entre servi\u00e7os configurando <code>Request-Id</code> e <code>traceparent</code>.</li> <li>Custom Metrics para RU Cosmos, lat\u00eancia externa, filas pendentes (se houver).</li> <li>Logs retidos conforme pol\u00edtica (ex.: 30 dias em dev, 90 em prd).</li> </ul>"},{"location":"conventions/#seguranca_1","title":"Seguran\u00e7a","text":"<ul> <li>HTTPS only e TLS 1.2+.</li> <li>Restri\u00e7\u00e3o de acesso a App Service (Access Restrictions) para endpoints de administra\u00e7\u00e3o.</li> </ul>"},{"location":"conventions/#anti-padroes-a-evitar_1","title":"Anti-padr\u00f5es a Evitar","text":"<ul> <li>Segredos commitados em reposit\u00f3rio.</li> <li>Deploy direto em produ\u00e7\u00e3o sem slot / sem valida\u00e7\u00e3o autom\u00e1tica.</li> </ul>"},{"location":"conventions/#qualidade-lint-formatacao-testes-e-hooks","title":"Qualidade: Lint, Formata\u00e7\u00e3o, Testes e Hooks","text":""},{"location":"conventions/#lint-e-formatacao","title":"Lint e Formata\u00e7\u00e3o","text":"<ul> <li>Web (Next/React/Tailwind):</li> <li>ESLint + Prettier.<ul> <li>Extens\u00f5es: <code>next/core-web-vitals</code>, <code>plugin:react/recommended</code>, <code>plugin:react-hooks/recommended</code>, <code>plugin:tailwindcss/recommended</code>.</li> <li>Prettier: 2 espa\u00e7os, <code>semi: true</code>, <code>singleQuote: true</code>, <code>trailingComma: all</code>.</li> </ul> </li> <li><code>editorconfig</code> para padronizar indenta\u00e7\u00e3o e finais de linha.</li> </ul>"},{"location":"conventions/#testes_1","title":"Testes","text":"<ul> <li>Web:</li> <li>Unit/Integration (UI): <code>Jest</code> + <code>@testing-library/react</code>.</li> <li>E2E: <code>Playwright</code>.</li> <li>Mocks de fetch: <code>whatwg-fetch</code>/<code>msw</code> quando necess\u00e1rio.</li> <li>APIs .NET: manter estrat\u00e9gia anterior (unit, integration, contract).</li> <li>Cobertura m\u00ednima sugerida: 80% linhas/branches.</li> </ul>"},{"location":"conventions/#hooks","title":"Hooks","text":"<ul> <li><code>husky</code> + <code>lint-staged</code> para validar c\u00f3digo antes de commits.</li> <li><code>commitlint</code> para impor padroniza\u00e7\u00e3o de Commits.</li> </ul>"},{"location":"conventions/#seguranca-e-configuracoes","title":"Seguran\u00e7a e Configura\u00e7\u00f5es","text":""},{"location":"conventions/#gerenciamento-de-segredos","title":"Gerenciamento de Segredos","text":"<ul> <li>Segredos armazenados exclusivamente como vari\u00e1veis de ambiente (App Settings no App Service e Configuration no SWA) e, no CI/CD, via GitHub Secrets. Nenhum segredo versionado no reposit\u00f3rio.</li> </ul>"},{"location":"conventions/#variaveis-e-configuracao","title":"Vari\u00e1veis e Configura\u00e7\u00e3o","text":"<ul> <li><code>.env</code> local apenas para desenvolvimento isolado (n\u00e3o commitado); fornecer <code>.env.example</code> m\u00ednimo sem valores sens\u00edveis.</li> </ul>"},{"location":"conventions/#entrada-e-validacao","title":"Entrada e Valida\u00e7\u00e3o","text":"<ul> <li>Sanitiza\u00e7\u00e3o e valida\u00e7\u00e3o em boundary layer: FluentValidation (C#) e checagens m\u00ednimas no Next (apenas estrutura de request/middleware quando necess\u00e1rio).</li> <li>Rejeitar payloads com tamanho excessivo (<code>MaxRequestBodySize</code>).</li> </ul>"},{"location":"conventions/#seguranca-http","title":"Seguran\u00e7a HTTP","text":"<ul> <li>Front (SWA): usar <code>staticwebapp.config.json</code> para <code>globalHeaders</code> (CSP, HSTS, X-Content-Type-Options, Referrer-Policy) e pol\u00edticas de cache. TLS \u00e9 gerenciado pelo Azure.</li> <li>APIs .NET: usar <code>UseHttpsRedirection</code>, <code>UseHsts</code> (exceto dev), CSP e headers de seguran\u00e7a. Habilitar CORS explicitamente para o dom\u00ednio do SWA quando houver chamadas client-side (<code>API_BASE_URL</code>).</li> </ul>"},{"location":"conventions/#protecao-de-dados-sensiveis","title":"Prote\u00e7\u00e3o de Dados Sens\u00edveis","text":"<ul> <li>Logs sem PII; se necess\u00e1rio, mascarar (<code>email</code>, <code>documentId</code>).</li> <li>Telemetria customizada filtrando payloads antes de enviar.</li> </ul>"},{"location":"conventions/#dependencias-e-vulnerabilidades","title":"Depend\u00eancias e Vulnerabilidades","text":"<ul> <li>Auditoria peri\u00f3dica: <code>dotnet list package --vulnerable</code> e <code>npm audit --production</code>.</li> <li>Renovar depend\u00eancias cr\u00edticas em janela controlada.</li> </ul>"},{"location":"conventions/#monitoramento","title":"Monitoramento","text":"<ul> <li>Application Insights alertas: taxa de erro &gt; 2%, lat\u00eancia p95 acima do SLO, RU Cosmos pr\u00f3xima do limite.</li> </ul>"},{"location":"conventions/#anti-padroes","title":"Anti-padr\u00f5es","text":"<ul> <li>Hardcode de chaves ou connection strings no c\u00f3digo.</li> <li>Logs de stack trace completos em produ\u00e7\u00e3o sem filtragem.</li> </ul>"},{"location":"conventions/#anexos-praticos-nextjs-swa","title":"Anexos pr\u00e1ticos (Next.js + SWA)","text":"<ul> <li>Inicializa\u00e7\u00e3o local: preferir usar o SWA CLI para gerar a configura\u00e7\u00e3o base (rotas, headers, fallback) e testar SSR/ISR localmente.</li> <li>Configura\u00e7\u00e3o: definir <code>staticwebapp.config.json</code> para <code>navigationFallback</code>, <code>globalHeaders</code> (CSP/HSTS/etc.) e regras de cache. Evitar criar manualmente sem <code>swa init</code>.</li> <li>Vari\u00e1veis de ambiente: <code>API_BASE_URL</code> (privada) e <code>NEXT_PUBLIC_*</code> (p\u00fablica). N\u00e3o versionar <code>.env</code>.</li> <li>Padr\u00e3o de fetch server-side com correla\u00e7\u00e3o:</li> <li>Enviar <code>x-correlation-id</code> nas chamadas \u00e0 API .NET e propagar IDs recebidos para logs/telemetria.</li> </ul>"},{"location":"conventions/#documentacao","title":"Documenta\u00e7\u00e3o","text":"<ul> <li>Manter este arquivo atualizado conforme o projeto evolui.</li> </ul>"},{"location":"conventions/#checklist-rapido-para-pr","title":"Checklist R\u00e1pido (para PR)","text":"<ul> <li>[ ] Seguiu conven\u00e7\u00f5es de branch e commits</li> <li>[ ] C\u00f3digo lintado e formatado</li> <li>[ ] Testes passaram e cobertura ok</li> <li>[ ] Migrations/Seeds (se aplic\u00e1vel) revisados</li> <li>[ ] Configura\u00e7\u00f5es de App Service / Slots revisadas</li> <li>[ ] Segredos configurados via App Settings/SWA Configuration/GitHub Secrets</li> <li>[ ] Documenta\u00e7\u00e3o ajustada</li> </ul>"},{"location":"gerencia-configuracao/","title":"Ger\u00eancia de Configura\u00e7\u00e3o de Software","text":"<p>Este documento detalha as pr\u00e1ticas, pol\u00edticas e ferramentas utilizadas para a Ger\u00eancia de Configura\u00e7\u00e3o do projeto Amaterasu - Safe Zone. Ele serve como guia para a manuten\u00e7\u00e3o da integridade do produto ao longo do seu ciclo de vida.</p>"},{"location":"gerencia-configuracao/#1-repositorios-de-codigo","title":"1. Reposit\u00f3rios de C\u00f3digo","text":"<p>O projeto adota uma estrat\u00e9gia de Monorepo, onde tanto o c\u00f3digo-fonte do frontend (Web) quanto do backend (API) residem no mesmo reposit\u00f3rio.</p> <ul> <li>Plataforma: GitHub</li> <li>URL: https://github.com/jj-viana/safe-zone</li> <li>Estrutura:</li> <li><code>/web</code>: Aplica\u00e7\u00e3o Frontend (Next.js)</li> <li><code>/api</code>: Aplica\u00e7\u00e3o Backend (.NET 9)</li> <li><code>/docs</code>: Documenta\u00e7\u00e3o do projeto</li> <li><code>/.github</code>: Workflows de CI/CD</li> <li><code>/tests</code>: Testes automatizados (integra\u00e7\u00e3o/unidade)</li> </ul>"},{"location":"gerencia-configuracao/#2-politicas-de-branches","title":"2. Pol\u00edticas de Branches","text":"<p>O projeto utiliza um fluxo de trabalho baseado em Git Flow Simplificado.</p>"},{"location":"gerencia-configuracao/#21-branches-principais","title":"2.1. Branches Principais","text":"<ul> <li><code>main</code>: Branch de produ\u00e7\u00e3o. Cont\u00e9m o c\u00f3digo est\u00e1vel e implantado. \u00c9 a fonte da verdade para o ambiente de produ\u00e7\u00e3o.</li> <li><code>development</code>: Branch de integra\u00e7\u00e3o. Todo o desenvolvimento de novas funcionalidades \u00e9 mesclado aqui primeiro para testes integrados.</li> </ul>"},{"location":"gerencia-configuracao/#22-branches-de-apoio","title":"2.2. Branches de Apoio","text":"<ul> <li><code>feature/*</code>: Para desenvolvimento de novas funcionalidades. Nascem de <code>development</code> e morrem em <code>development</code>.</li> <li><code>fix/*</code>: Para corre\u00e7\u00e3o de bugs. Nascem de <code>development</code> e morrem em <code>development</code>.</li> <li><code>chore/*</code>: Para tarefas de manuten\u00e7\u00e3o (configura\u00e7\u00f5es, depend\u00eancias).</li> <li><code>docs/*</code>: Para altera\u00e7\u00f5es apenas em documenta\u00e7\u00e3o.</li> </ul>"},{"location":"gerencia-configuracao/#23-regras-de-protecao-branch-protection-rules","title":"2.3. Regras de Prote\u00e7\u00e3o (Branch Protection Rules)","text":"<p>As branches <code>main</code> e <code>development</code> s\u00e3o protegidas e possuem as seguintes restri\u00e7\u00f5es: - Require pull request reviews before merging: \u00c9 obrigat\u00f3ria a aprova\u00e7\u00e3o de pelo menos 1 revisor. - Require status checks to pass before merging: Os checks de CI (Lint, Build, Testes) devem passar obrigatoriamente. - Require review from Code Owners: N\u00e3o \u00e9 obrigat\u00f3ria a aprova\u00e7\u00e3o do Code Owner. - Restri\u00e7\u00e3o de Origem: A branch <code>main</code> aceita Pull Requests exclusivamente vindos da branch <code>development</code>. - Do not allow bypassing the above settings: Desabilitado. Administradores podem ignorar as regras em casos de emerg\u00eancia.</p>"},{"location":"gerencia-configuracao/#3-politicas-de-contribuicao","title":"3. Pol\u00edticas de Contribui\u00e7\u00e3o","text":""},{"location":"gerencia-configuracao/#31-fluxo-de-pull-request-pr","title":"3.1. Fluxo de Pull Request (PR)","text":"<ol> <li>Crie uma branch a partir de <code>development</code>.</li> <li>Realize as altera\u00e7\u00f5es locais.</li> <li>Abra um Pull Request (PR) apontando para <code>development</code>.</li> <li>O CI ser\u00e1 disparado automaticamente (<code>pr-validation</code>).</li> <li>Solicite revis\u00e3o de pares.</li> <li>Ap\u00f3s aprova\u00e7\u00e3o e CI verde, o PR \u00e9 mesclado.</li> </ol>"},{"location":"gerencia-configuracao/#32-padrao-de-commits","title":"3.2. Padr\u00e3o de Commits","text":"<p>O projeto segue a conven\u00e7\u00e3o Conventional Commits para padronizar as mensagens e facilitar a automa\u00e7\u00e3o de releases.</p> <p>Formato: <code>&lt;tipo&gt;(&lt;escopo opcional&gt;)!: &lt;descri\u00e7\u00e3o curta&gt;</code></p> <p>Tipos permitidos: - <code>feat</code>: Nova funcionalidade. - <code>fix</code>: Corre\u00e7\u00e3o de bug. - <code>docs</code>: Documenta\u00e7\u00e3o. - <code>style</code>: Formata\u00e7\u00e3o, falta de ponto e v\u00edrgula, etc. (sem altera\u00e7\u00e3o de c\u00f3digo). - <code>refactor</code>: Refatora\u00e7\u00e3o de c\u00f3digo (sem fix ou feat). - <code>test</code>: Adi\u00e7\u00e3o ou corre\u00e7\u00e3o de testes. - <code>chore</code>: Atualiza\u00e7\u00e3o de build, ferramentas, etc.</p> <p>Exemplo: <code>feat(api): adiciona endpoint de relat\u00f3rios</code></p>"},{"location":"gerencia-configuracao/#4-versionamento","title":"4. Versionamento","text":"<p>O projeto adota o Semantic Versioning (SemVer) 2.0.0 (<code>MAJOR.MINOR.PATCH</code>).</p> <ul> <li>MAJOR: Mudan\u00e7as incompat\u00edveis na API ou quebras de contrato.</li> <li>MINOR: Funcionalidades novas compat\u00edveis com vers\u00f5es anteriores.</li> <li>PATCH: Corre\u00e7\u00f5es de bugs compat\u00edveis com vers\u00f5es anteriores. Automa\u00e7\u00e3o e Releases:</li> <li>PATCH (vX.X.Z): O pipeline de CD gera automaticamente tags de vers\u00e3o ao realizar o deploy em produ\u00e7\u00e3o, incrementando o <code>PATCH</code> da \u00faltima vers\u00e3o encontrada.</li> <li>MAJOR e MINOR (vX.0.0, vX.Y.0): Para grandes lan\u00e7amentos (\"Big Releases\"), a tag de vers\u00e3o deve ser criada manualmente no reposit\u00f3rio. O workflow respeitar\u00e1 a tag existente.</li> </ul>"},{"location":"gerencia-configuracao/#5-integracao-continua-ci","title":"5. Integra\u00e7\u00e3o Cont\u00ednua (CI)","text":"<p>A Integra\u00e7\u00e3o Cont\u00ednua \u00e9 realizada via GitHub Actions.</p> <ul> <li>Workflow: <code>.github/workflows/pr-validation.yml</code></li> <li>Gatilhos:</li> <li>Pull Requests para <code>development</code>.</li> <li>Pull Requests de <code>development</code> para <code>main</code>.</li> <li>Etapas (Jobs):</li> <li>Web Quality: Instala depend\u00eancias, executa Lint (<code>npm run lint</code>) e Build (<code>npm run build</code>) do frontend.</li> <li>API Quality: Restaura pacotes, compila (<code>dotnet build</code>) e executa testes automatizados (<code>dotnet test</code>) do backend.</li> <li>Pol\u00edtica: O merge do PR \u00e9 bloqueado se qualquer etapa do CI falhar.</li> <li>Reten\u00e7\u00e3o: Logs de execu\u00e7\u00e3o e artefatos s\u00e3o mantidos por 90 dias (padr\u00e3o do GitHub).</li> </ul>"},{"location":"gerencia-configuracao/#6-entrega-continua-cd","title":"6. Entrega Cont\u00ednua (CD)","text":"<p>A Entrega Cont\u00ednua automatiza o deploy para os ambientes Azure. - Workflow: <code>.github/workflows/release-deploy.yml</code> - Gatilho: Push na branch <code>main</code> (geralmente via merge de PR). - Otimiza\u00e7\u00e3o: O workflow verifica quais pastas sofreram altera\u00e7\u00f5es (<code>web/</code> ou <code>api/</code> e/ou <code>tests/</code>) e executa apenas as etapas de build e deploy necess\u00e1rias para os componentes modificados. - Etapas:   1.  Build: Gera os artefatos de produ\u00e7\u00e3o para Web e API (se houver mudan\u00e7as).   2.  Deploy Web: Publica o frontend no Azure Static Web Apps (se houver mudan\u00e7as em <code>web/</code>).   3.  Deploy API: Publica o backend no Azure App Service (se houver mudan\u00e7as em <code>api/</code>).   4.  Release: Cria uma Release no GitHub e gera uma tag de vers\u00e3o.</p>"},{"location":"gerencia-configuracao/#7-licenca","title":"7. Licen\u00e7a","text":"<p>O projeto \u00e9 distribu\u00eddo sob a licen\u00e7a GNU Affero General Public License v3.0 (AGPL-3.0). Isso implica que o c\u00f3digo \u00e9 aberto e qualquer modifica\u00e7\u00e3o distribu\u00edda ou disponibilizada via rede deve ter seu c\u00f3digo-fonte tamb\u00e9m disponibilizado sob a mesma licen\u00e7a.</p>"},{"location":"api/","title":"API - Safe Zone","text":"<p>API REST desenvolvida em ASP.NET Core 9.0 para gerenciamento de den\u00fancias de incidentes. A aplica\u00e7\u00e3o fornece endpoints para opera\u00e7\u00f5es de CRUD, integra-se com Azure Cosmos DB (API NoSQL) para persist\u00eancia de dados e utiliza Application Insights para observabilidade.</p>"},{"location":"api/#visao-geral","title":"Vis\u00e3o Geral","text":"<p>Este projeto segue os princ\u00edpios de Clean Architecture, separando responsabilidades em camadas distintas:</p> <ul> <li>Controllers: Coordena\u00e7\u00e3o de requisi\u00e7\u00f5es HTTP e mapeamento de respostas</li> <li>Services: L\u00f3gica de neg\u00f3cio e orquestra\u00e7\u00e3o de opera\u00e7\u00f5es</li> <li>Models: DTOs e entidades de dom\u00ednio</li> <li>Interfaces: Abstra\u00e7\u00f5es e contratos de servi\u00e7os</li> <li>Configuration: Configura\u00e7\u00e3o de inje\u00e7\u00e3o de depend\u00eancias e op\u00e7\u00f5es</li> </ul> <p>A API utiliza o SDK <code>Microsoft.Azure.Cosmos</code> v3 com boas pr\u00e1ticas de performance e consist\u00eancia, incluindo suporte a opera\u00e7\u00f5es de patch para atualiza\u00e7\u00f5es parciais eficientes.</p>"},{"location":"api/#tecnologias","title":"Tecnologias","text":"<ul> <li>.NET 9.0: Framework principal</li> <li>ASP.NET Core: Web API</li> <li>Azure Cosmos DB: Banco de dados NoSQL (API SQL)</li> <li>Application Insights: Telemetria e monitoramento</li> <li>Swagger/OpenAPI: Documenta\u00e7\u00e3o de API</li> </ul>"},{"location":"api/#pre-requisitos","title":"Pr\u00e9-requisitos","text":"<p>Antes de executar a aplica\u00e7\u00e3o, certifique-se de ter:</p> <ul> <li>.NET SDK 9.0 ou superior instalado</li> <li>Conta Azure ativa com:</li> <li>Azure Cosmos DB (API for NoSQL) provisionado</li> <li>Application Insights (opcional, para telemetria)</li> <li>Editor de c\u00f3digo (recomendado: Visual Studio Code com extens\u00e3o C# Dev Kit)</li> </ul>"},{"location":"api/#configuracao","title":"Configura\u00e7\u00e3o","text":""},{"location":"api/#1-variaveis-de-ambiente","title":"1. Vari\u00e1veis de Ambiente","text":"<p>A aplica\u00e7\u00e3o pode ser configurada atrav\u00e9s do arquivo <code>appsettings.json</code> ou vari\u00e1veis de ambiente. Para desenvolvimento local, utilize User Secrets para armazenar credenciais sens\u00edveis.</p>"},{"location":"api/#estrutura-do-appsettingsjson","title":"Estrutura do <code>appsettings.json</code>","text":"<pre><code>{\n  \"Logging\": {\n    \"LogLevel\": {\n      \"Default\": \"Information\",\n      \"Microsoft.AspNetCore\": \"Warning\"\n    }\n  },\n  \"AllowedHosts\": \"*\",\n  \"CosmosDB\": {\n    \"ConnectionString\": \"&lt;sua-connection-string&gt;\",\n    \"DatabaseId\": \"ReportsDb\",\n    \"ContainerId\": \"Reports\",\n    \"EnableContentResponseOnWrite\": false\n  },\n  \"ApplicationInsights\": {\n    \"ConnectionString\": \"&lt;sua-connection-string&gt;\"\n  },\n  \"Cors\": {\n    \"AllowedOrigins\": [\n      \"http://localhost:3000\",\n      \"https://seu-dominio-frontend.com\"\n    ]\n  }\n}\n</code></pre> <p>\u26a0\ufe0f Seguran\u00e7a: Nunca versione credenciais no <code>appsettings.json</code>. Use User Secrets localmente e vari\u00e1veis de ambiente via App Settings (App Service/SWA Configuration) em produ\u00e7\u00e3o.</p>"},{"location":"api/#2-configuracao-do-cosmos-db","title":"2. Configura\u00e7\u00e3o do Cosmos DB","text":"<p>A aplica\u00e7\u00e3o cria automaticamente o banco de dados e cont\u00eainer se n\u00e3o existirem. A configura\u00e7\u00e3o padr\u00e3o utiliza:</p> <ul> <li>Partition Key: <code>/id</code></li> <li>Naming Policy: camelCase</li> <li>Connection Mode: Gateway (recomendado para desenvolvimento)</li> </ul> <p>Para ambientes de produ\u00e7\u00e3o, considere: - Ajustar o throughput (RU/s) conforme demanda - Habilitar modo Direct para melhor performance - Configurar pol\u00edticas de indexa\u00e7\u00e3o otimizadas</p>"},{"location":"api/#3-configuracao-do-cors","title":"3. Configura\u00e7\u00e3o do CORS","text":"<p>Por padr\u00e3o, a API aceita requisi\u00e7\u00f5es do front-end local (<code>http://localhost:3000</code>). Para adicionar outros dom\u00ednios, atualize a se\u00e7\u00e3o <code>Cors:AllowedOrigins</code> no <code>appsettings.json</code> ou via vari\u00e1veis de ambiente.</p>"},{"location":"api/#executando-a-aplicacao","title":"Executando a Aplica\u00e7\u00e3o","text":""},{"location":"api/#desenvolvimento-local","title":"Desenvolvimento Local","text":"<ol> <li> <p>Clone o reposit\u00f3rio (se ainda n\u00e3o o fez):    <pre><code>git clone &lt;url-do-repositorio&gt;\ncd safe-zone/api\n</code></pre></p> </li> <li> <p>Restaure as depend\u00eancias:    <pre><code>dotnet restore\n</code></pre></p> </li> <li> <p>Configure os appsettings (veja se\u00e7\u00e3o de Configura\u00e7\u00e3o acima)</p> </li> <li> <p>Execute a aplica\u00e7\u00e3o:    <pre><code>dotnet run\n</code></pre></p> </li> <li> <p>Acesse a documenta\u00e7\u00e3o Swagger:</p> </li> <li>URL: <code>https://localhost:5001/swagger</code></li> <li>Use a interface interativa para testar os endpoints</li> </ol>"},{"location":"api/#endpoints-de-infraestrutura","title":"Endpoints de Infraestrutura","text":"<ul> <li>Health Check: <code>/</code> - Retorna o status de sa\u00fade da aplica\u00e7\u00e3o.</li> <li>Swagger UI: <code>/swagger</code> - Dispon\u00edvel apenas em ambiente de desenvolvimento.</li> </ul>"},{"location":"api/#executando-os-testes","title":"Executando os Testes","text":"<p>Para executar os testes unit\u00e1rios e de integra\u00e7\u00e3o:</p> <pre><code>dotnet test\n</code></pre>"},{"location":"api/#gerando-relatorio-de-cobertura-html","title":"Gerando Relat\u00f3rio de Cobertura (HTML)","text":"<p>Para gerar um relat\u00f3rio de cobertura de c\u00f3digo em HTML:</p> <ol> <li> <p>Execute os testes com coleta de cobertura:    <pre><code>dotnet test --collect:\"XPlat Code Coverage\"\n</code></pre></p> </li> <li> <p>Instale a ferramenta de gera\u00e7\u00e3o de relat\u00f3rio (se necess\u00e1rio):    <pre><code>dotnet tool install -g dotnet-reportgenerator-globaltool\n</code></pre></p> </li> <li> <p>Gere o relat\u00f3rio:    <pre><code>reportgenerator -reports:tests/TestResults/*/coverage.cobertura.xml -targetdir:coverage-report -reporttypes:Html\n</code></pre></p> </li> <li> <p>Abra <code>coverage-report/index.html</code> no navegador.</p> </li> </ol>"},{"location":"api/#estrutura-do-projeto","title":"Estrutura do Projeto","text":"<pre><code>api/\n\u251c\u2500\u2500 Controllers/        # Endpoints HTTP\n\u251c\u2500\u2500 Services/          # L\u00f3gica de neg\u00f3cio\n\u251c\u2500\u2500 Models/            # DTOs e modelos\n\u251c\u2500\u2500 Interfaces/        # Contratos e abstra\u00e7\u00f5es\n\u251c\u2500\u2500 Configuration/     # Classes de configura\u00e7\u00e3o\n\u251c\u2500\u2500 Properties/        # Configura\u00e7\u00f5es de launch\n\u251c\u2500\u2500 Program.cs        # Ponto de entrada\n\u2514\u2500\u2500 appsettings.json  # Configura\u00e7\u00f5es (sem secrets)\n\ntests/\n\u251c\u2500\u2500 ControllerTests/    # Testes de unidade dos controllers\n\u251c\u2500\u2500 IntegrationTests/   # Testes de integra\u00e7\u00e3o (E2E)\n\u2514\u2500\u2500 Services/          # Testes de unidade dos servi\u00e7os e Fakes\n</code></pre>"},{"location":"api/#observabilidade","title":"Observabilidade","text":"<p>A API integra-se com Azure Application Insights para monitoramento e telemetria:</p>"},{"location":"api/#metricas-customizadas","title":"M\u00e9tricas Customizadas","text":"<ul> <li>cosmos.request.units: Consumo de RUs por opera\u00e7\u00e3o no Cosmos DB</li> <li>Dimens\u00f5es: <code>operation</code>, <code>databaseId</code>, <code>containerId</code>, <code>statusCode</code></li> </ul>"},{"location":"api/#logs-estruturados","title":"Logs Estruturados","text":"<p>Todos os servi\u00e7os utilizam <code>ILogger&lt;T&gt;</code> para logging contextual. Logs s\u00e3o enviados automaticamente para Application Insights quando configurado.</p>"},{"location":"api/#correlation-id","title":"Correlation ID","text":"<p>Requisi\u00e7\u00f5es podem incluir o header <code>x-correlation-id</code> para rastreamento distribu\u00eddo. Se ausente, um ID ser\u00e1 gerado automaticamente.</p>"},{"location":"api/api/","title":"Documenta\u00e7\u00e3o da API Safe Zone","text":"<p>Esta API permite o gerenciamento de relat\u00f3rios de incidentes de seguran\u00e7a.</p>"},{"location":"api/api/#endpoints","title":"Endpoints","text":""},{"location":"api/api/#relatorios","title":"Relat\u00f3rios","text":""},{"location":"api/api/#criar-um-novo-relatorio","title":"Criar um novo relat\u00f3rio","text":"<p>Cria um novo relat\u00f3rio de incidente.</p> <ul> <li>URL: <code>/api/Reports</code></li> <li>M\u00e9todo: <code>POST</code></li> <li>Corpo da Requisi\u00e7\u00e3o: <code>CreateReportRequest</code></li> <li>Respostas:</li> <li><code>201 Created</code>: Relat\u00f3rio criado com sucesso. Retorna o objeto <code>ReportResponse</code>.</li> <li><code>400 Bad Request</code>: Dados inv\u00e1lidos fornecidos.</li> <li><code>500 Internal Server Error</code>: Erro inesperado no servidor.</li> </ul>"},{"location":"api/api/#listar-todos-os-relatorios","title":"Listar todos os relat\u00f3rios","text":"<p>Retorna uma lista de todos os relat\u00f3rios de incidentes, opcionalmente filtrados por status.</p> <ul> <li>URL: <code>/api/Reports</code></li> <li>M\u00e9todo: <code>GET</code></li> <li>Par\u00e2metros de Consulta:</li> <li><code>status</code> (opcional): Filtra os relat\u00f3rios pelo status fornecido.</li> <li>Respostas:</li> <li><code>200 OK</code>: Lista de relat\u00f3rios retornada com sucesso. Retorna uma lista de <code>ReportResponse</code>.</li> <li><code>500 Internal Server Error</code>: Erro inesperado no servidor.</li> </ul>"},{"location":"api/api/#listar-relatorios-por-genero-de-crime","title":"Listar relat\u00f3rios por g\u00eanero de crime","text":"<p>Retorna uma lista de relat\u00f3rios filtrados por um g\u00eanero de crime espec\u00edfico.</p> <ul> <li>URL: <code>/api/Reports/crime-genre/{crimeGenre}</code></li> <li>M\u00e9todo: <code>GET</code></li> <li>Par\u00e2metros de Rota:</li> <li><code>crimeGenre</code>: O g\u00eanero do crime para filtrar.</li> <li>Respostas:</li> <li><code>200 OK</code>: Lista de relat\u00f3rios retornada com sucesso.</li> <li><code>400 Bad Request</code>: Requisi\u00e7\u00e3o inv\u00e1lida.</li> <li><code>500 Internal Server Error</code>: Erro inesperado no servidor.</li> </ul>"},{"location":"api/api/#listar-relatorios-por-tipo-de-crime","title":"Listar relat\u00f3rios por tipo de crime","text":"<p>Retorna uma lista de relat\u00f3rios filtrados por um tipo de crime espec\u00edfico.</p> <ul> <li>URL: <code>/api/Reports/crime-type/{crimeType}</code></li> <li>M\u00e9todo: <code>GET</code></li> <li>Par\u00e2metros de Rota:</li> <li><code>crimeType</code>: O tipo do crime para filtrar.</li> <li>Respostas:</li> <li><code>200 OK</code>: Lista de relat\u00f3rios retornada com sucesso.</li> <li><code>400 Bad Request</code>: Requisi\u00e7\u00e3o inv\u00e1lida.</li> <li><code>500 Internal Server Error</code>: Erro inesperado no servidor.</li> </ul>"},{"location":"api/api/#obter-relatorio-por-id","title":"Obter relat\u00f3rio por ID","text":"<p>Retorna os detalhes de um relat\u00f3rio espec\u00edfico pelo seu ID.</p> <ul> <li>URL: <code>/api/Reports/{id}</code></li> <li>M\u00e9todo: <code>GET</code></li> <li>Par\u00e2metros de Rota:</li> <li><code>id</code>: O identificador \u00fanico do relat\u00f3rio.</li> <li>Respostas:</li> <li><code>200 OK</code>: Relat\u00f3rio encontrado. Retorna o objeto <code>ReportResponse</code>.</li> <li><code>404 Not Found</code>: Relat\u00f3rio n\u00e3o encontrado.</li> <li><code>500 Internal Server Error</code>: Erro inesperado no servidor.</li> </ul>"},{"location":"api/api/#atualizar-relatorio","title":"Atualizar relat\u00f3rio","text":"<p>Atualiza as informa\u00e7\u00f5es de um relat\u00f3rio existente.</p> <ul> <li>URL: <code>/api/Reports/{id}</code></li> <li>M\u00e9todo: <code>PATCH</code></li> <li>Par\u00e2metros de Rota:</li> <li><code>id</code>: O identificador \u00fanico do relat\u00f3rio a ser atualizado.</li> <li>Corpo da Requisi\u00e7\u00e3o: <code>UpdateReportRequest</code></li> <li>Respostas:</li> <li><code>200 OK</code>: Relat\u00f3rio atualizado com sucesso. Retorna o objeto <code>ReportResponse</code> atualizado.</li> <li><code>400 Bad Request</code>: Dados inv\u00e1lidos ou opera\u00e7\u00e3o inv\u00e1lida.</li> <li><code>404 Not Found</code>: Relat\u00f3rio n\u00e3o encontrado.</li> <li><code>500 Internal Server Error</code>: Erro inesperado no servidor.</li> </ul>"},{"location":"api/api/#deletar-relatorio","title":"Deletar relat\u00f3rio","text":"<p>Remove um relat\u00f3rio do sistema.</p> <ul> <li>URL: <code>/api/Reports/{id}</code></li> <li>M\u00e9todo: <code>DELETE</code></li> <li>Par\u00e2metros de Rota:</li> <li><code>id</code>: O identificador \u00fanico do relat\u00f3rio a ser removido.</li> <li>Respostas:</li> <li><code>204 No Content</code>: Relat\u00f3rio deletado com sucesso.</li> <li><code>404 Not Found</code>: Relat\u00f3rio n\u00e3o encontrado.</li> <li><code>500 Internal Server Error</code>: Erro inesperado no servidor.</li> </ul>"},{"location":"api/api/#modelos","title":"Modelos","text":""},{"location":"api/api/#createreportrequest","title":"CreateReportRequest","text":"<p>Objeto utilizado para criar um novo relat\u00f3rio.</p> Propriedade Tipo Obrigat\u00f3rio Descri\u00e7\u00e3o <code>crimeGenre</code> string Sim G\u00eanero do crime (m\u00e1x. 256 caracteres). <code>crimeType</code> string Sim Tipo do crime (m\u00e1x. 256 caracteres). <code>description</code> string Sim Descri\u00e7\u00e3o detalhada do incidente (m\u00e1x. 2048 caracteres). <code>location</code> string Sim Localiza\u00e7\u00e3o do incidente (m\u00e1x. 512 caracteres). <code>region</code> string Sim Regi\u00e3o do incidente (m\u00e1x. 128 caracteres). <code>crimeDate</code> string ($date-time) Sim Data e hora do crime. <code>reporterDetails</code> ReporterDetailsRequest N\u00e3o Detalhes opcionais sobre o relator. <code>status</code> string Sim Status inicial do relat\u00f3rio (m\u00e1x. 64 caracteres). <code>resolved</code> boolean Sim Indica se o incidente foi resolvido."},{"location":"api/api/#updatereportrequest","title":"UpdateReportRequest","text":"<p>Objeto utilizado para atualizar um relat\u00f3rio existente. Todos os campos s\u00e3o opcionais.</p> Propriedade Tipo Descri\u00e7\u00e3o <code>crimeGenre</code> string G\u00eanero do crime. <code>crimeType</code> string Tipo do crime. <code>description</code> string Descri\u00e7\u00e3o do incidente. <code>location</code> string Localiza\u00e7\u00e3o do incidente. <code>region</code> string Regi\u00e3o do incidente. <code>crimeDate</code> string ($date-time) Data e hora do crime. <code>reporterDetails</code> ReporterDetailsRequest Detalhes sobre o relator. <code>resolved</code> boolean Indica se o incidente foi resolvido. <code>status</code> string Status do relat\u00f3rio."},{"location":"api/api/#reportresponse","title":"ReportResponse","text":"<p>Objeto retornado contendo os detalhes do relat\u00f3rio.</p> Propriedade Tipo Descri\u00e7\u00e3o <code>id</code> string Identificador \u00fanico do relat\u00f3rio. <code>crimeGenre</code> string G\u00eanero do crime. <code>crimeType</code> string Tipo do crime. <code>description</code> string Descri\u00e7\u00e3o do incidente. <code>location</code> string Localiza\u00e7\u00e3o do incidente. <code>region</code> string Regi\u00e3o do incidente. <code>crimeDate</code> string ($date-time) Data e hora do crime. <code>reporterDetails</code> ReporterDetailsResponse Detalhes sobre o relator. <code>status</code> string Status atual do relat\u00f3rio. <code>createdDate</code> string ($date-time) Data de cria\u00e7\u00e3o do registro. <code>resolved</code> boolean Indica se o incidente foi resolvido."},{"location":"api/api/#reporterdetailsrequest-reporterdetailsresponse","title":"ReporterDetailsRequest / ReporterDetailsResponse","text":"<p>Detalhes demogr\u00e1ficos do relator.</p> Propriedade Tipo Descri\u00e7\u00e3o <code>ageGroup</code> string Faixa et\u00e1ria. <code>ethnicity</code> string Etnia. <code>genderIdentity</code> string Identidade de g\u00eanero. <code>sexualOrientation</code> string Orienta\u00e7\u00e3o sexual."},{"location":"api/tests/","title":"Documenta\u00e7\u00e3o de Testes - Safe Zone API","text":"<p>Esta documenta\u00e7\u00e3o detalha a estrat\u00e9gia de testes, como execut\u00e1-los, gerar relat\u00f3rios de cobertura e descreve o prop\u00f3sito de cada conjunto de testes no projeto Safe Zone API.</p>"},{"location":"api/tests/#visao-geral","title":"Vis\u00e3o Geral","text":"<p>O projeto utiliza xUnit como framework de testes principal. A su\u00edte de testes \u00e9 dividida em: - Testes Unit\u00e1rios: Focados em testar componentes isolados (Controllers e Services) usando Moq para simular depend\u00eancias. - Testes de Integra\u00e7\u00e3o: Focados em testar o fluxo completo da API usando <code>Microsoft.AspNetCore.Mvc.Testing</code>.</p>"},{"location":"api/tests/#estrutura-do-projeto-de-testes","title":"Estrutura do Projeto de Testes","text":"<p>O projeto de testes (<code>tests/tests.csproj</code>) est\u00e1 organizado da seguinte forma:</p> <ul> <li>ControllerTests/: Testes unit\u00e1rios para o <code>ReportsController</code>. Verificam as respostas HTTP, valida\u00e7\u00e3o de <code>ModelState</code> e chamadas corretas ao servi\u00e7o.</li> <li>Services/: Testes unit\u00e1rios para o <code>ReportService</code> e <code>CosmosTelemetry</code>. Verificam a l\u00f3gica de neg\u00f3cios, tratamento de exce\u00e7\u00f5es e intera\u00e7\u00e3o com o Cosmos DB (mockado).</li> <li>IntegrationTests/: Testes de integra\u00e7\u00e3o que sobem uma inst\u00e2ncia da API em mem\u00f3ria para testar os endpoints reais.</li> <li>Fakes/: Cont\u00e9m objetos falsos e utilit\u00e1rios para auxiliar nos testes.</li> </ul>"},{"location":"api/tests/#como-rodar-os-testes","title":"Como Rodar os Testes","text":""},{"location":"api/tests/#pre-requisitos","title":"Pr\u00e9-requisitos","text":"<p>Certifique-se de ter o .NET 9.0 SDK instalado.</p>"},{"location":"api/tests/#executando-todos-os-testes","title":"Executando todos os testes","text":"<p>Para rodar todos os testes do projeto, execute o seguinte comando na raiz do reposit\u00f3rio ou na pasta <code>tests/</code>:</p> <pre><code>dotnet test\n</code></pre>"},{"location":"api/tests/#executando-testes-especificos","title":"Executando testes espec\u00edficos","text":"<p>Para rodar apenas um conjunto de testes espec\u00edfico (por exemplo, testes de cria\u00e7\u00e3o de relat\u00f3rios):</p> <pre><code>dotnet test --filter \"FullyQualifiedName~CreateTests\"\n</code></pre>"},{"location":"api/tests/#relatorio-de-cobertura-de-codigo-html","title":"Relat\u00f3rio de Cobertura de C\u00f3digo (HTML)","text":"<p>O projeto utiliza Coverlet para coletar dados de cobertura e ReportGenerator para criar relat\u00f3rios HTML leg\u00edveis.</p>"},{"location":"api/tests/#1-gerar-o-arquivo-de-cobertura","title":"1. Gerar o arquivo de cobertura","text":"<p>Execute os testes com a coleta de cobertura habilitada. Isso gerar\u00e1 um arquivo <code>coverage.cobertura.xml</code> dentro de <code>tests/TestResults/{guid}/</code>.</p> <pre><code>dotnet test --collect:\"XPlat Code Coverage\"\n</code></pre>"},{"location":"api/tests/#2-gerar-o-relatorio-html","title":"2. Gerar o Relat\u00f3rio HTML","text":"<p>Para transformar o XML em um site HTML naveg\u00e1vel, voc\u00ea precisa da ferramenta <code>dotnet-reportgenerator-globaltool</code>.</p> <p>Instalar a ferramenta (se ainda n\u00e3o tiver): <pre><code>dotnet tool install -g dotnet-reportgenerator-globaltool\n</code></pre></p> <p>Gerar o relat\u00f3rio: Execute o comando abaixo na raiz do reposit\u00f3rio:</p> <pre><code>reportgenerator -reports:tests/TestResults/*/coverage.cobertura.xml -targetdir:coverage-report -reporttypes:Html\n</code></pre> <p>O relat\u00f3rio estar\u00e1 dispon\u00edvel na pasta <code>coverage-report/index.html</code>. Abra este arquivo no navegador para visualizar a cobertura detalhada por classe e m\u00e9todo.</p>"},{"location":"api/tests/#detalhamento-dos-testes","title":"Detalhamento dos Testes","text":""},{"location":"api/tests/#1-testes-de-controller-controllertests","title":"1. Testes de Controller (<code>ControllerTests</code>)","text":"<p>Estes testes garantem que os endpoints da API respondam com os c\u00f3digos de status HTTP corretos e estruturas de dados esperadas.</p> <ul> <li>ReportsControllerCreateTests:</li> <li>Valida se <code>CreateAsync</code> retorna <code>201 Created</code> com um payload v\u00e1lido.</li> <li>Valida se retorna <code>400 BadRequest</code> (ValidationProblem) quando o <code>ModelState</code> \u00e9 inv\u00e1lido (ex: campos obrigat\u00f3rios faltando).</li> <li>ReportsControllerGetTests:</li> <li>Valida se <code>GetByIdAsync</code> retorna o relat\u00f3rio correto.</li> <li>Valida o tratamento de erros (ex: <code>500 Internal Server Error</code>) quando o servi\u00e7o falha.</li> <li>ReportsControllerUpdateTests e ReportsControllerDeleteTests:</li> <li>Validam as opera\u00e7\u00f5es de atualiza\u00e7\u00e3o e remo\u00e7\u00e3o, garantindo os retornos <code>200 OK</code>, <code>204 No Content</code> ou erros apropriados.</li> </ul>"},{"location":"api/tests/#2-testes-de-servico-services","title":"2. Testes de Servi\u00e7o (<code>Services</code>)","text":"<p>Focam na l\u00f3gica de neg\u00f3cios e na intera\u00e7\u00e3o com o banco de dados (simulado).</p> <ul> <li>ReportServiceCreateTests:</li> <li>Verifica se todos os campos obrigat\u00f3rios (<code>CrimeGenre</code>, <code>CrimeType</code>, <code>Description</code>, etc.) lan\u00e7am <code>ArgumentException</code> se nulos.</li> <li>Garante que a data do crime \u00e9 normalizada para UTC.</li> <li>Verifica se o ID \u00e9 gerado corretamente.</li> <li>ReportServiceQueryTests:</li> <li>Testa a constru\u00e7\u00e3o de queries LINQ para o Cosmos DB.</li> <li>CosmosTelemetryTests:</li> <li>Valida se a telemetria (Application Insights) \u00e9 enviada apenas quando h\u00e1 consumo de RUs (Request Units) positivo.</li> <li>Garante que m\u00e9tricas n\u00e3o s\u00e3o enviadas se o custo for zero ou negativo.</li> <li>ReportServiceTestHelper:</li> <li>Classe utilit\u00e1ria que configura o <code>ReportService</code> com Mocks do <code>Container</code> do Cosmos DB e <code>ICosmosTelemetry</code>, facilitando a cria\u00e7\u00e3o de cen\u00e1rios de teste.</li> </ul>"},{"location":"api/tests/#3-testes-de-integracao-integrationtests","title":"3. Testes de Integra\u00e7\u00e3o (<code>IntegrationTests</code>)","text":"<p>Utilizam o <code>CustomWebApplicationFactory</code> para criar um servidor de teste em mem\u00f3ria.</p> <ul> <li>Factory.cs: Configura o ambiente de teste (<code>Testing</code>) e aponta para o diret\u00f3rio correto da API.</li> <li>ReportsIntegrationCreateTests:</li> <li>Envia requisi\u00e7\u00f5es HTTP POST reais para <code>/api/reports</code>.</li> <li>Verifica se o registro \u00e9 efetivamente criado e retornado.</li> <li>Valida a serializa\u00e7\u00e3o/deserializa\u00e7\u00e3o JSON.</li> <li>Outros testes de integra\u00e7\u00e3o: Cobrem GET, PUT e DELETE, garantindo que o contrato da API seja respeitado ponta a ponta.</li> </ul>"},{"location":"api/tests/#validacoes-principais-cobertas","title":"Valida\u00e7\u00f5es Principais Cobertas","text":"<p>Os testes garantem as seguintes regras de neg\u00f3cio e valida\u00e7\u00f5es:</p> <ol> <li>Campos Obrigat\u00f3rios: <code>CrimeGenre</code>, <code>CrimeType</code>, <code>Description</code>, <code>Location</code>, <code>Region</code>, <code>Status</code> n\u00e3o podem ser nulos ou vazios.</li> <li>Datas: <code>CrimeDate</code> deve ser v\u00e1lida.</li> <li>Integridade: O sistema n\u00e3o deve falhar catastroficamente (exce\u00e7\u00f5es n\u00e3o tratadas) ao receber dados inv\u00e1lidos; deve retornar mensagens de erro adequadas.</li> <li>Telemetria: O consumo de recursos do banco de dados \u00e9 monitorado corretamente.</li> </ol> <p>Nota: Para manter a qualidade do c\u00f3digo, recomenda-se rodar a su\u00edte de testes completa antes de qualquer commit ou push para o reposit\u00f3rio.</p>"},{"location":"web/web/","title":"Documenta\u00e7\u00e3o Web - SafeZone","text":"<p>Este documento descreve a estrutura, tecnologias e configura\u00e7\u00e3o do frontend da aplica\u00e7\u00e3o SafeZone.</p>"},{"location":"web/web/#visao-geral","title":"Vis\u00e3o Geral","text":"<p>O projeto web \u00e9 constru\u00eddo utilizando Next.js (App Router), focado em performance, SEO e experi\u00eancia do usu\u00e1rio. A aplica\u00e7\u00e3o permite que usu\u00e1rios fa\u00e7am den\u00fancias de forma segura e an\u00f4nima, al\u00e9m de fornecer dashboards para visualiza\u00e7\u00e3o de dados e uma \u00e1rea administrativa.</p>"},{"location":"web/web/#tecnologias-utilizadas","title":"Tecnologias Utilizadas","text":"<p>As principais tecnologias e bibliotecas utilizadas no projeto s\u00e3o:</p> <ul> <li>Framework: Next.js 15 com React 19.</li> <li>Linguagem: TypeScript.</li> <li>Estiliza\u00e7\u00e3o: Tailwind CSS v4.</li> <li>Autentica\u00e7\u00e3o: Autentica\u00e7\u00e3o nativa do Azure Static Web Apps via Azure AD (Entra ID).</li> <li>Mapas: Leaflet e React Leaflet.</li> <li>Gr\u00e1ficos: Recharts.</li> <li>\u00cdcones: React Icons.</li> <li>Valida\u00e7\u00e3o/Seguran\u00e7a: <code>react-google-recaptcha</code> para prote\u00e7\u00e3o contra bots.</li> </ul>"},{"location":"web/web/#estrutura-do-projeto","title":"Estrutura do Projeto","text":"<p>A estrutura de pastas segue o padr\u00e3o do Next.js App Router:</p> <pre><code>web/\n\u251c\u2500\u2500 app/                    # P\u00e1ginas e Layouts (App Router)\n\u2502   \u251c\u2500\u2500 admin/              # \u00c1rea administrativa (protegida)\n\u2502   \u251c\u2500\u2500 components/         # Componentes reutiliz\u00e1veis\n\u2502   \u2502   \u251c\u2500\u2500 crime-nature-bar-chart/\n\u2502   \u2502   \u251c\u2500\u2500 crime-type-line-chart/\n\u2502   \u2502   \u251c\u2500\u2500 map/            # Componentes de mapa\n\u2502   \u2502   \u251c\u2500\u2500 navbar/\n\u2502   \u2502   \u2514\u2500\u2500 ...\n\u2502   \u251c\u2500\u2500 dashboards/         # P\u00e1ginas de visualiza\u00e7\u00e3o de dados p\u00fablicos\n\u2502   \u251c\u2500\u2500 login/              # P\u00e1gina de login/redirecionamento\n\u2502   \u251c\u2500\u2500 sobre/              # P\u00e1gina institucional\n\u2502   \u251c\u2500\u2500 layout.tsx          # Layout principal da aplica\u00e7\u00e3o (RootLayout)\n\u2502   \u2514\u2500\u2500 page.tsx            # P\u00e1gina inicial (Home)\n\u251c\u2500\u2500 lib/                    # L\u00f3gica compartilhada e utilit\u00e1rios\n\u2502   \u251c\u2500\u2500 api/                # Clientes HTTP e defini\u00e7\u00f5es de tipos da API\n\u2502   \u251c\u2500\u2500 constants/          # Constantes globais (ex: regi\u00f5es, tipos de crime)\n\u2502   \u251c\u2500\u2500 hooks/              # React Hooks customizados (ex: useReportSubmission)\n\u2502   \u2514\u2500\u2500 utils/              # Fun\u00e7\u00f5es utilit\u00e1rias (formata\u00e7\u00e3o de data, mappers)\n\u251c\u2500\u2500 public/                 # Arquivos est\u00e1ticos (imagens, \u00edcones, manifestos)\n\u251c\u2500\u2500 .env.example            # Exemplo de vari\u00e1veis de ambiente\n\u251c\u2500\u2500 next.config.mjs          # Configura\u00e7\u00f5es do Next.js\n\u251c\u2500\u2500 tailwind.config.ts      # Configura\u00e7\u00f5es do Tailwind (se aplic\u00e1vel/impl\u00edcito)\n\u2514\u2500\u2500 staticwebapp.config.json # Configura\u00e7\u00e3o de deploy para Azure Static Web Apps\n</code></pre>"},{"location":"web/web/#configuracao-e-instalacao","title":"Configura\u00e7\u00e3o e Instala\u00e7\u00e3o","text":""},{"location":"web/web/#pre-requisitos","title":"Pr\u00e9-requisitos","text":"<ul> <li>Node.js (vers\u00e3o 20 ou superior recomendada)</li> <li>Gerenciador de pacotes (npm, yarn, pnpm ou bun)</li> </ul>"},{"location":"web/web/#instalacao","title":"Instala\u00e7\u00e3o","text":"<ol> <li> <p>Navegue at\u00e9 a pasta <code>web</code>:     <pre><code>cd web\n</code></pre></p> </li> <li> <p>Instale as depend\u00eancias:     <pre><code>npm install\n</code></pre></p> </li> </ol>"},{"location":"web/web/#variaveis-de-ambiente","title":"Vari\u00e1veis de Ambiente","text":"<p>Crie um arquivo <code>.env.local</code> na raiz da pasta <code>web</code> com as seguintes vari\u00e1veis (baseado em <code>.env.example</code>):</p> <pre><code>NEXT_PUBLIC_API_BASE_URL=http://localhost:5206\nNEXT_PUBLIC_RECAPTCHA_SITE_KEY= # opcional\n</code></pre>"},{"location":"web/web/#executando-localmente","title":"Executando Localmente","text":"<p>Para iniciar o servidor de desenvolvimento com Turbopack (mais r\u00e1pido):</p> <pre><code>npm run dev\n</code></pre> <p>A aplica\u00e7\u00e3o estar\u00e1 dispon\u00edvel em <code>http://localhost:3000</code>.</p>"},{"location":"web/web/#scripts-disponiveis","title":"Scripts Dispon\u00edveis","text":"<ul> <li><code>npm run dev</code>: Inicia o ambiente de desenvolvimento.</li> <li><code>npm run build</code>: Cria a build de produ\u00e7\u00e3o.</li> <li><code>npm run start</code>: Inicia o servidor de produ\u00e7\u00e3o.</li> <li><code>npm run lint</code>: Executa a verifica\u00e7\u00e3o de linting (ESLint).</li> </ul>"},{"location":"web/web/#autenticacao","title":"Autentica\u00e7\u00e3o","text":"<p>A prote\u00e7\u00e3o da \u00e1rea administrativa \u00e9 feita pela camada de autentica\u00e7\u00e3o nativa do Azure Static Web Apps com Azure AD (Entra ID).</p> <ul> <li>Configura\u00e7\u00e3o: <code>staticwebapp.config.json</code> marca <code>/admin</code> e <code>/admin/*</code> com <code>allowedRoles: [\"admin\"]</code>. Os usu\u00e1rios s\u00e3o associados a esse role no portal (modo Simple).</li> <li>Fluxo: A p\u00e1gina <code>/login</code> apenas dispara <code>/.auth/login/aad?post_login_redirect_uri=/admin</code>, mantendo um reCAPTCHA opcional antes do redirecionamento.</li> <li>Sess\u00e3o: O front-end consulta <code>/.auth/me</code> para detectar sess\u00f5es existentes e redirecionar automaticamente administradores autenticados, eliminando o uso de tokens personalizados e middleware.</li> </ul>"},{"location":"web/web/#integracao-com-api","title":"Integra\u00e7\u00e3o com API","text":"<p>A comunica\u00e7\u00e3o com o backend \u00e9 centralizada em <code>lib/api/</code>.</p> <ul> <li>Reports Client: Gerencia o envio (POST) e consulta (GET) de den\u00fancias.</li> <li>Tipagem: Interfaces TypeScript (ex: <code>Report</code>, <code>CreateReportRequest</code>) garantem a integridade dos dados entre frontend e backend.</li> </ul>"},{"location":"web/web/#deploy","title":"Deploy","text":"<p>O projeto est\u00e1 configurado para deploy no Azure Static Web Apps.</p> <ul> <li>Arquivo de Configura\u00e7\u00e3o: <code>staticwebapp.config.json</code> define regras de roteamento, cabe\u00e7alhos de seguran\u00e7a e configura\u00e7\u00f5es da plataforma.</li> <li>Build: O comando <code>npm run build</code> gera os arquivos est\u00e1ticos na pasta <code>.next</code> (ou <code>out</code> dependendo da configura\u00e7\u00e3o de exporta\u00e7\u00e3o) que s\u00e3o servidos pelo Azure.</li> </ul>"},{"location":"web/web/#paginas-e-funcionalidades","title":"P\u00e1ginas e Funcionalidades","text":"<p>A aplica\u00e7\u00e3o \u00e9 composta pelas seguintes p\u00e1ginas principais, cada uma com funcionalidades espec\u00edficas:</p>"},{"location":"web/web/#1-pagina-inicial","title":"1. P\u00e1gina Inicial (<code>/</code>)","text":"<p>A landing page da aplica\u00e7\u00e3o, projetada para ser o ponto de entrada para den\u00fancias. -   Mapa Interativo: Exibe um mapa onde usu\u00e1rios podem visualizar ocorr\u00eancias (dependendo da implementa\u00e7\u00e3o) ou selecionar um local para realizar uma den\u00fancia. -   Anima\u00e7\u00e3o de Fundo: Apresenta uma anima\u00e7\u00e3o com cadeados flutuantes (<code>FloatingLock</code>), refor\u00e7ando a tem\u00e1tica de seguran\u00e7a. -   Modal de Den\u00fancia: Ao interagir com o mapa, um modal (<code>ReportModal</code>) \u00e9 aberto, permitindo que o usu\u00e1rio preencha os detalhes da ocorr\u00eancia de forma an\u00f4nima.</p>"},{"location":"web/web/#2-dashboards-publicos-dashboards","title":"2. Dashboards P\u00fablicos (<code>/dashboards</code>)","text":"<p>\u00c1rea dedicada \u00e0 transpar\u00eancia e visualiza\u00e7\u00e3o de dados agregados das den\u00fancias aprovadas. -   Gr\u00e1ficos Diversos:     -   Demografia: Gr\u00e1ficos de pizza e barras mostrando distribui\u00e7\u00e3o por etnia, faixa et\u00e1ria, identidade de g\u00eanero e orienta\u00e7\u00e3o sexual dos denunciantes.     -   Criminalidade: Gr\u00e1ficos de linha e barras detalhando tipos de crime e natureza das ocorr\u00eancias ao longo do tempo. -   Filtros Avan\u00e7ados: Permite filtrar os dados visualizados por:     -   G\u00eanero do crime (Crime/Sensa\u00e7\u00e3o de Inseguran\u00e7a).     -   Tipos espec\u00edficos de crime.     -   Regi\u00f5es.     -   Anos.</p>"},{"location":"web/web/#3-area-administrativa-admin","title":"3. \u00c1rea Administrativa (<code>/admin</code>)","text":"<p>P\u00e1gina restrita para moderadores e administradores do sistema. -   Gest\u00e3o de Den\u00fancias: Lista as den\u00fancias recebidas, organizadas em abas por status:     -   Rascunho (Draft): Novas den\u00fancias aguardando an\u00e1lise.     -   Aprovadas (Approved): Den\u00fancias validadas e vis\u00edveis nos dashboards.     -   Negadas (Denied): Den\u00fancias rejeitadas. -   Modera\u00e7\u00e3o: Permite visualizar detalhes de uma den\u00fancia e realizar a\u00e7\u00f5es de aprova\u00e7\u00e3o ou rejei\u00e7\u00e3o. -   Filtragem e Busca: Ferramentas para buscar den\u00fancias espec\u00edficas por texto, tipo, regi\u00e3o ou data.</p>"},{"location":"web/web/#4-sobre-sobre","title":"4. Sobre (<code>/sobre</code>)","text":"<p>P\u00e1gina institucional que apresenta o projeto SafeZone. -   Miss\u00e3o e Vis\u00e3o: Explica o objetivo da plataforma em transformar den\u00fancias em dados para seguran\u00e7a p\u00fablica. -   Interatividade: Possui um elemento visual interativo (mascote) com efeito 3D que reage ao movimento do mouse. -   Equipe: Apresenta os membros respons\u00e1veis pelo desenvolvimento do projeto.</p>"},{"location":"web/web/#5-login-login","title":"5. Login (<code>/login</code>)","text":"<p>P\u00e1gina respons\u00e1vel por disparar o fluxo de autentica\u00e7\u00e3o. -   Valida o reCAPTCHA (quando configurado) e encaminha o usu\u00e1rio para <code>/.auth/login/aad?post_login_redirect_uri=/admin</code>. -   Consulta <code>/.auth/me</code> para identificar sess\u00f5es j\u00e1 autenticadas e, se necess\u00e1rio, redireciona imediatamente para <code>/admin</code>.</p>"}]}